<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><meta data-react-helmet="true" property="og:type" content="website"/><meta data-react-helmet="true" property="og:image" content="/og-image.png"/><meta data-react-helmet="true" property="og:author" content="송소민"/><meta data-react-helmet="true" property="og:description" content="0. LSM (Linux Security Module) Linux Security Module(LSM) 프레임워크는 Security Module을 지원하는 커널 프레임워크를 제공한다.
특히, LSM은 리눅스에서 MAC(Mandatory Access Control; 강제 접근 제어)을 구현하는데 중점을 두고 있지만, 향후에는 샌드박싱과 같은 다른 보안 요구 사항을 해결할 수 있다. LSM 프레임워크 그 자체로는 추가적인 보안 기능을 제공하지는 않는다. 다만, Security Module을 지원하기 위한 인프라를 제공할 뿐이다.
LSM은 매번 커널 소스 코드를 구정할 필요 없이 MAC을 구현하기 위한 필수적인 컴포넌트들을 제공한다.
이러한 LSM을 활용하면 application whitelist를 쉽고 편리하게 구현할 수 있다. LSM 프레임워크는 리눅스 커널 곳곳에 Hook을 넣어 커널에서 발생하는 여러 민감한 동작 부분에서 Hook을 Security Module에게 제공하고,
해당…"/><meta data-react-helmet="true" name="description" content="0. LSM (Linux Security Module) Linux Security Module(LSM) 프레임워크는 Security Module을 지원하는 커널 프레임워크를 제공한다.
특히, LSM은 리눅스에서 MAC(Mandatory Access Control; 강제 접근 제어)을 구현하는데 중점을 두고 있지만, 향후에는 샌드박싱과 같은 다른 보안 요구 사항을 해결할 수 있다. LSM 프레임워크 그 자체로는 추가적인 보안 기능을 제공하지는 않는다. 다만, Security Module을 지원하기 위한 인프라를 제공할 뿐이다.
LSM은 매번 커널 소스 코드를 구정할 필요 없이 MAC을 구현하기 위한 필수적인 컴포넌트들을 제공한다.
이러한 LSM을 활용하면 application whitelist를 쉽고 편리하게 구현할 수 있다. LSM 프레임워크는 리눅스 커널 곳곳에 Hook을 넣어 커널에서 발생하는 여러 민감한 동작 부분에서 Hook을 Security Module에게 제공하고,
해당…"/><meta data-react-helmet="true" property="og:site_title" content="TIL - LSM(Linux Security Module)"/><meta data-react-helmet="true" property="og:title" content="TIL - LSM(Linux Security Module)"/><meta data-react-helmet="true" name="viewport" content="initial-scale=1, width=device-width"/><meta name="generator" content="Gatsby 4.9.3"/><style data-href="/styles.853e65090dc89bfbb4ac.css" data-identity="gatsby-global-css">@font-face{font-display:swap;font-family:Montserrat;font-style:normal;font-weight:100;src:local("Montserrat Thin "),local("Montserrat-Thin"),url(/static/montserrat-latin-100-8d7d79679b70dbe27172b6460e7a7910.woff2) format("woff2"),url(/static/montserrat-latin-100-ec38980a9e0119a379e2a9b3dbb1901a.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:italic;font-weight:100;src:local("Montserrat Thin italic"),local("Montserrat-Thinitalic"),url(/static/montserrat-latin-100italic-e279051046ba1286706adc886cf1c96b.woff2) format("woff2"),url(/static/montserrat-latin-100italic-3b325a3173c8207435cd1b76e19bf501.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:normal;font-weight:200;src:local("Montserrat Extra Light "),local("Montserrat-Extra Light"),url(/static/montserrat-latin-200-9d266fbbfa6cab7009bd56003b1eeb67.woff2) format("woff2"),url(/static/montserrat-latin-200-2d8ba08717110d27122e54c34b8a5798.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:italic;font-weight:200;src:local("Montserrat Extra Light italic"),local("Montserrat-Extra Lightitalic"),url(/static/montserrat-latin-200italic-6e5b3756583bb2263eb062eae992735e.woff2) format("woff2"),url(/static/montserrat-latin-200italic-a0d6f343e4b536c582926255367a57da.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:normal;font-weight:300;src:local("Montserrat Light "),local("Montserrat-Light"),url(/static/montserrat-latin-300-00b3e893aab5a8fd632d6342eb72551a.woff2) format("woff2"),url(/static/montserrat-latin-300-ea303695ceab35f17e7d062f30e0173b.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:italic;font-weight:300;src:local("Montserrat Light italic"),local("Montserrat-Lightitalic"),url(/static/montserrat-latin-300italic-56f34ea368f6aedf89583d444bbcb227.woff2) format("woff2"),url(/static/montserrat-latin-300italic-54b0bf2c8c4c12ffafd803be2466a790.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:normal;font-weight:400;src:local("Montserrat Regular "),local("Montserrat-Regular"),url(/static/montserrat-latin-400-b71748ae4f80ec8c014def4c5fa8688b.woff2) format("woff2"),url(/static/montserrat-latin-400-0659a9f4e90db5cf51b50d005bff1e41.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:italic;font-weight:400;src:local("Montserrat Regular italic"),local("Montserrat-Regularitalic"),url(/static/montserrat-latin-400italic-6eed6b4cbb809c6efc7aa7ddad6dbe3e.woff2) format("woff2"),url(/static/montserrat-latin-400italic-7583622cfde30ae49086d18447ab28e7.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:normal;font-weight:500;src:local("Montserrat Medium "),local("Montserrat-Medium"),url(/static/montserrat-latin-500-091b209546e16313fd4f4fc36090c757.woff2) format("woff2"),url(/static/montserrat-latin-500-edd311588712a96bbf435fad264fff62.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:italic;font-weight:500;src:local("Montserrat Medium italic"),local("Montserrat-Mediumitalic"),url(/static/montserrat-latin-500italic-c90ced68b46050061d1a41842d6dfb43.woff2) format("woff2"),url(/static/montserrat-latin-500italic-5146cbfe02b1deea5dffea27a5f2f998.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:normal;font-weight:600;src:local("Montserrat SemiBold "),local("Montserrat-SemiBold"),url(/static/montserrat-latin-600-0480d2f8a71f38db8633b84d8722e0c2.woff2) format("woff2"),url(/static/montserrat-latin-600-b77863a375260a05dd13f86a1cee598f.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:italic;font-weight:600;src:local("Montserrat SemiBold italic"),local("Montserrat-SemiBolditalic"),url(/static/montserrat-latin-600italic-cf46ffb11f3a60d7df0567f8851a1d00.woff2) format("woff2"),url(/static/montserrat-latin-600italic-c4fcfeeb057724724097167e57bd7801.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:normal;font-weight:700;src:local("Montserrat Bold "),local("Montserrat-Bold"),url(/static/montserrat-latin-700-7dbcc8a5ea2289d83f657c25b4be6193.woff2) format("woff2"),url(/static/montserrat-latin-700-99271a835e1cae8c76ef8bba99a8cc4e.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:italic;font-weight:700;src:local("Montserrat Bold italic"),local("Montserrat-Bolditalic"),url(/static/montserrat-latin-700italic-c41ad6bdb4bd504a843d546d0a47958d.woff2) format("woff2"),url(/static/montserrat-latin-700italic-6779372f04095051c62ed36bc1dcc142.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:normal;font-weight:800;src:local("Montserrat ExtraBold "),local("Montserrat-ExtraBold"),url(/static/montserrat-latin-800-db9a3e0ba7eaea32e5f55328ace6cf23.woff2) format("woff2"),url(/static/montserrat-latin-800-4e3c615967a2360f5db87d2f0fd2456f.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:italic;font-weight:800;src:local("Montserrat ExtraBold italic"),local("Montserrat-ExtraBolditalic"),url(/static/montserrat-latin-800italic-bf45bfa14805969eda318973947bc42b.woff2) format("woff2"),url(/static/montserrat-latin-800italic-fe82abb0bcede51bf724254878e0c374.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:normal;font-weight:900;src:local("Montserrat Black "),local("Montserrat-Black"),url(/static/montserrat-latin-900-e66c7edc609e24bacbb705175669d814.woff2) format("woff2"),url(/static/montserrat-latin-900-8211f418baeb8ec880b80ba3c682f957.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:italic;font-weight:900;src:local("Montserrat Black italic"),local("Montserrat-Blackitalic"),url(/static/montserrat-latin-900italic-4454c775e48152c1a72510ceed3603e2.woff2) format("woff2"),url(/static/montserrat-latin-900italic-efcaa0f6a82ee0640b83a0916e6e8d68.woff) format("woff")}.search-input-wrapper{align-items:center;display:none;margin-top:3px;width:180px}@media(min-width:768px){.search-input-wrapper{display:flex}}.search-icon{color:var(--primary-text-color);margin-right:2px}.search-input{height:100%;width:100%}.search-input .MuiAutocomplete-inputRoot{padding-right:0!important}.search-input .MuiInputBase-input{color:var(--primary-text-color)!important;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Helvetica,Arial,sans-serif,Apple Color Emoji,Segoe UI Emoji;font-size:16px;font-weight:500;padding-bottom:2px!important}.search-input .MuiInput-underline:before{border-bottom-width:1px}.search-input .MuiInput-underline:after,.search-input .MuiInput-underline:before{border-bottom-color:var(--primary-text-color)}.page-header-wrapper{display:flex;height:60px;justify-content:center;width:100%}.page-header-wrapper .page-header{align-items:center;display:flex;justify-content:space-between;max-width:720px;width:100%}.page-header-wrapper .page-header .link{color:var(--primary-text-color);font-size:17px;font-weight:700}@media(min-width:768px){.page-header-wrapper .page-header .link{font-size:20px;font-weight:700}}.page-header-wrapper .page-header .trailing-section{align-items:center;display:flex}.page-header-wrapper .page-header .trailing-section .link{margin-right:10px}@media(min-width:768px){.page-header-wrapper .page-header .trailing-section .link{margin-right:20px}}.page-footer-wrapper{align-items:center;display:flex;height:62px;justify-content:center;margin-top:auto;width:100%}.page-footer-wrapper .page-footer{max-width:720px;text-align:center;width:100%}.page-footer-wrapper .page-footer .link{color:var(--primary-text-color);font-size:20px;font-weight:700;margin-right:20px}.page-footer-wrapper .page-footer a{color:#3a95ff}.dark-mode-button-wrapper{align-items:center;bottom:20px;display:flex;justify-content:center;position:fixed;right:20px}.dark-mode-button{-webkit-backdrop-filter:blur(30px);backdrop-filter:blur(30px);background-color:#363f47!important;border-radius:50px;box-shadow:0 5px 25px rgba(0,0,0,.12);cursor:pointer;height:50px;width:50px;z-index:3}.dark-mode-icon{color:#fff}a,abbr,acronym,address,applet,article,aside,audio,b,big,blockquote,body,canvas,caption,center,cite,code,dd,del,details,dfn,div,dl,dt,em,embed,fieldset,figcaption,figure,footer,form,h1,h2,h3,h4,h5,h6,header,hgroup,html,i,iframe,img,ins,kbd,label,legend,li,mark,menu,nav,object,ol,output,p,pre,q,ruby,s,samp,section,small,span,strike,strong,sub,summary,sup,table,tbody,td,tfoot,th,thead,time,tr,tt,u,ul,var,video{border:0;font-size:100%;font:inherit;margin:0;padding:0;vertical-align:baseline}article,aside,details,figcaption,figure,footer,header,hgroup,menu,nav,section{display:block}body{line-height:1}ol,ul{list-style:none}blockquote,q{quotes:none}blockquote:after,blockquote:before,q:after,q:before{content:"";content:none}table{border-collapse:collapse;border-spacing:0}a{outline:none;text-decoration:none}html{--background-color:#fff;--primary-text-color:#000;--secondary-text-color:#9e9e9e;--content-text-color:#37352f;--button-background-color:#f3f3f4;--button-text-color:#363f47;--tab-text-color:#6e6d7a;--tab-hover-text-color:#0d0c22;--tab-selected-background-color:rgba(13,12,34,.05);--bio-link-icon-color:rgba(0,0,0,.54);--about-link-icon-color:#a8a8a8;--chip-background-color:#f3f3f4;--link-text-color:rgba(55,53,47,.7);--post-card-border-color:rgba(0,0,0,.12);--markdown-table-even-cell-background-color:#f6f8fa;--markdown-table-border-color:#dfe2e5;--markdown-blockquote-border-color:#dfe2e5;--markdown-border-color:#e1e4e8}html[data-theme=dark]{--background-color:#232326;--primary-text-color:#e6e6e6;--secondary-text-color:#768390;--content-text-color:#e6e6e6;--button-background-color:#444c56;--button-text-color:#363f47;--tab-text-color:#768390;--tab-hover-text-color:#acbac7;--tab-selected-background-color:#373e47;--chip-background-color:#323a42;--bio-link-icon-color:#e6e6e6;--about-link-icon-color:#a8a8a8;--link-text-color:#90b0ec;--post-card-border-color:#363f47;--markdown-table-even-cell-background-color:#2d333b;--markdown-table-border-color:#444c56;--markdown-blockquote-border-color:#4f5864;--markdown-border-color:#e1e4e8}*{-webkit-appearance:none;appearance:none;box-sizing:border-box}html{font-size:14px;height:100%;overflow-y:scroll;width:100%}body{background-color:var(--background-color)!important}a{color:var(--link-text-color)}.page-wrapper{-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;color:var(--primary-text-color);font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Helvetica,Arial,sans-serif,Apple Color Emoji,Segoe UI Emoji;justify-content:center;min-height:100vh;padding-left:15px;padding-right:15px;word-break:keep-all}.page-wrapper,.page-wrapper .page-content{align-items:center;display:flex;flex-direction:column;width:100%}.page-wrapper .page-content{max-width:720px}.icon{color:var(--about-link-icon-color);font-size:20px}.social-links .icon{color:var(--bio-link-icon-color);font-size:30px}@-webkit-keyframes blinking-cursor{0%{opacity:0}50%{opacity:1}to{opacity:0}}@keyframes blinking-cursor{0%{opacity:0}50%{opacity:1}to{opacity:0}}.bio{color:var(--primary-text-color);display:flex;flex-direction:column;justify-content:space-between;margin-bottom:120px;margin-top:120px;width:100%}@media(min-width:768px){.bio{align-items:center;flex-direction:row}}.bio .introduction{display:flex;flex-direction:column;word-break:keep-all}.bio .introduction .react-rotating-text-cursor{-webkit-animation:blinking-cursor .8s cubic-bezier(.68,.01,.01,.99) 0s infinite;animation:blinking-cursor .8s cubic-bezier(.68,.01,.01,.99) 0s infinite}.bio .introduction strong{display:inline-block;font-weight:600}.bio .introduction.korean{font-size:32px;font-weight:100;line-height:1.2}.bio .introduction.korean .title .react-rotating-text-cursor{font-size:35px;line-height:35px}@media(min-width:768px){.bio .introduction.korean{font-size:40px}.bio .introduction.korean .title .react-rotating-text-cursor{font-size:45px;line-height:45px}}.bio .introduction.english{font-family:montserrat;font-size:25px;line-height:1.2}@media(min-width:768px){.bio .introduction.english{font-size:45px}}.bio .introduction.english .name{font-size:35px;font-weight:600}.bio .introduction.english .job{font-size:35px}.bio .introduction.english .description{font-size:20px;font-weight:200;margin-top:8px}.bio .introduction.english .social-links{display:flex;margin-top:20px}.bio .thumbnail-wrapper{display:none}@media(min-width:768px){.bio .thumbnail-wrapper{display:block}}.section-header-wrapper{display:flex;justify-content:center;margin-bottom:32px;width:100%}.section-header-wrapper .section-header{border-bottom:4px solid var(--primary-text-color);color:var(--primary-text-color);font-size:30px;font-weight:700;padding-bottom:5px}.timestamp-section{align-items:center;display:flex;flex-direction:column;justify-content:center;margin-bottom:50px;width:100%;word-break:keep-all}.timestamp-section .body{padding:0 10px;width:100%}.timestamp-section .body .timestamp{border-left:2px solid #bdbdbd;display:flex;font-size:18px;font-weight:400;justify-items:center;margin-left:5px;padding:10px 0;width:100%}.timestamp-section .body .timestamp:first-child{padding-top:7px}.timestamp-section .body .timestamp:last-child{padding-bottom:7px}.timestamp-section .body .timestamp:before{align-self:center;background-color:var(--background-color);border:2px solid #828282;border-radius:10px;content:"";height:10px;left:-1px;position:relative;-webkit-transform:translatex(-50%);transform:translatex(-50%);width:10px}.timestamp-section .body .timestamp .date{align-self:center;color:#828282;margin-left:5px;margin-right:5px;min-width:115px;width:115px}@media(min-width:768px){.timestamp-section .body .timestamp .date{min-width:200px;width:200px}}.timestamp-section .body .timestamp .activity{line-height:23px;width:100%}.project-section{align-items:center;justify-content:center}.project-section,.project-section .project{display:flex;flex-direction:column;width:100%}.project-section .project{margin-bottom:30px;padding:15px}.project-section .project .head{font-size:20px;font-weight:700;line-height:30px;margin-bottom:10px}.project-section .project .body{display:flex;flex-direction:column;width:100%}.project-section .project .body .thumbnail{margin-bottom:10px;width:100%}.project-section .project .body .tech-stack{display:flex;margin-bottom:10px}.project-section .project .body .tech-stack .tech{background-color:var(--chip-background-color);border-radius:10px;font-size:15px;font-weight:500;margin-right:5px;padding:5px 7px}.project-section .project .body .description{font-size:16px;font-weight:400;line-height:1.4}@media(min-width:768px){.project-section .project .body{flex-direction:column}.project-section .project .body .content{margin-top:0}}.post-header{border-bottom:1px solid var(--post-card-border-color);display:flex;flex-direction:column;justify-content:center;margin-bottom:40px;margin-top:20px;padding-bottom:10px;width:100%;word-break:keep-all}.post-header .emoji{font-size:78px;margin-bottom:20px}.post-header .categories{margin-bottom:5px}.post-header .categories .category{color:var(--primary-text-color);font-weight:600;margin-right:4px}.post-header .categories .category:hover{text-decoration:underline}.post-header .title{color:var(--primary-text-color);font-size:32px;font-weight:600;line-height:1.3;margin-bottom:6px}.post-header .info{color:var(--secondary-text-color);display:flex;flex-wrap:wrap;font-size:16px;font-weight:500;line-height:1.5;width:100%}.post-header .info .author{margin-right:4px}.post-header .info strong{color:var(--primary-text-color);font-weight:600}.post-navigator{-webkit-column-gap:1.4%;column-gap:1.4%;display:grid;grid-template-columns:49.3% 49.3%;width:100%}.post-navigator .post-card{border:1px solid var(--post-card-border-color);border-radius:6px;color:var(--primary-text-color);cursor:pointer;display:flex;flex-direction:column;padding:15px;transition:-webkit-transform .2s;transition:transform .2s;transition:transform .2s,-webkit-transform .2s;width:100%}.post-navigator .post-card:hover .title{text-decoration:underline}.post-navigator .post-card.prev{margin-right:auto}.post-navigator .post-card.next{margin-left:auto}.post-navigator .post-card .direction{color:gray;font-size:14px;font-weight:500;margin-bottom:5px}.post-navigator .post-card .title{font-size:16px;font-weight:600;line-height:1.4;margin-bottom:7px}.markdown .octicon{fill:currentColor;display:inline-block;vertical-align:text-bottom}.markdown .anchor{float:left;line-height:1;margin-left:-20px;padding-right:4px}.markdown .anchor:focus{outline:none}.markdown h1 .octicon-link,.markdown h2 .octicon-link,.markdown h3 .octicon-link,.markdown h4 .octicon-link,.markdown h5 .octicon-link,.markdown h6 .octicon-link{color:#1b1f23;vertical-align:middle;visibility:hidden}.markdown h1:hover .anchor,.markdown h2:hover .anchor,.markdown h3:hover .anchor,.markdown h4:hover .anchor,.markdown h5:hover .anchor,.markdown h6:hover .anchor{text-decoration:none}.markdown h1:hover .anchor .octicon-link,.markdown h2:hover .anchor .octicon-link,.markdown h3:hover .anchor .octicon-link,.markdown h4:hover .anchor .octicon-link,.markdown h5:hover .anchor .octicon-link,.markdown h6:hover .anchor .octicon-link{visibility:visible}.markdown h1:hover .anchor .octicon-link:before,.markdown h2:hover .anchor .octicon-link:before,.markdown h3:hover .anchor .octicon-link:before,.markdown h4:hover .anchor .octicon-link:before,.markdown h5:hover .anchor .octicon-link:before,.markdown h6:hover .anchor .octicon-link:before{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' aria-hidden='true' viewBox='0 0 16 16'%3E%3Cpath fill-rule='evenodd' d='M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z'/%3E%3C/svg%3E");content:" ";display:inline-block;height:16px;width:16px}.markdown{-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%;word-wrap:break-word;color:var(--content-text-color);font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Helvetica,Arial,sans-serif,Apple Color Emoji,Segoe UI Emoji;font-size:16px;font-weight:500;line-height:1.5}.markdown details{display:block}.markdown summary{display:list-item}.markdown a{background-color:initial}.markdown a:active,.markdown a:hover{outline-width:0}.markdown strong{font-weight:inherit;font-weight:bolder}.markdown h1{margin:.67em 0}.markdown img{border-style:none}.markdown code,.markdown kbd,.markdown pre{font-family:monospace,monospace;font-size:1em}.markdown hr{box-sizing:initial;overflow:visible}.markdown input{font:inherit;margin:0;overflow:visible}.markdown [type=checkbox]{box-sizing:border-box;padding:0}.markdown *{box-sizing:border-box}.markdown input{font-family:inherit;font-size:inherit;line-height:inherit}.markdown a{border-bottom:.05em solid;border-color:var(--link-text-color);color:var(--link-text-color);text-decoration:none}.markdown a.anchor{border-bottom:none}.markdown strong{font-weight:700}.markdown hr{background:transparent;border-bottom:1px solid var(--markdown-blockquote-border-color);height:0;margin:15px 0;overflow:hidden}.markdown hr:after,.markdown hr:before{content:"";display:table}.markdown hr:after{clear:both}.markdown table{border-collapse:collapse;border-spacing:0}.markdown td,.markdown th{padding:0}.markdown details summary{cursor:pointer}.markdown h1,.markdown h2,.markdown h3,.markdown h4,.markdown h5,.markdown h6{margin-bottom:0;margin-top:0}.markdown h1{font-size:32px}.markdown h1,.markdown h2{font-weight:600}.markdown h2{font-size:24px}.markdown h3{font-size:20px}.markdown h3,.markdown h4{font-weight:600}.markdown h4{font-size:16px}.markdown h5{font-size:14px}.markdown h5,.markdown h6{font-weight:600}.markdown h6{font-size:12px}.markdown p{margin-bottom:10px;margin-top:0}.markdown blockquote{margin:0}.markdown ol,.markdown ul{margin-bottom:0;margin-top:0;padding-left:0}.markdown ol ol,.markdown ul ol{list-style-type:lower-roman}.markdown ol ol ol,.markdown ol ul ol,.markdown ul ol ol,.markdown ul ul ol{list-style-type:lower-alpha}.markdown dd{margin-left:0}.markdown code,.markdown pre{font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;font-size:12px}.markdown code.language-text{border-radius:3px;font-size:85%;padding:.2em .4em}.markdown :not(pre)>code.language-text{background:hsla(44,6%,50%,.15);color:#eb5757;overflow-wrap:break-word}.markdown pre{margin-bottom:0;margin-top:0}.markdown input::-webkit-inner-spin-button,.markdown input::-webkit-outer-spin-button{-webkit-appearance:none;appearance:none;margin:0}.markdown :checked+.radio-label{border-color:#0366d6;position:relative;z-index:1}.markdown .border{border:1px solid var(--markdown-border-color)!important}.markdown .border-0{border:0!important}.markdown .border-bottom{border-bottom:1px solid var(--markdown-border-color)!important}.markdown .rounded-1{border-radius:3px!important}.markdown .bg-white{background-color:transparent!important}.markdown .bg-gray-light{background-color:#fafbfc!important}.markdown .text-gray-light{color:#6a737d!important}.markdown .pl-3,.markdown .px-3{padding-left:16px!important}.markdown .px-3{padding-right:16px!important}.markdown .f6{font-size:12px!important}.markdown .lh-condensed{line-height:1.25!important}.markdown .text-bold{font-weight:600!important}.markdown .pl-c{color:#6a737d}.markdown .pl-c1,.markdown .pl-s .pl-v{color:#005cc5}.markdown .pl-e,.markdown .pl-en{color:#6f42c1}.markdown .pl-s .pl-s1,.markdown .pl-smi{color:#24292e}.markdown .pl-ent{color:#22863a}.markdown .pl-k{color:#d73a49}.markdown .pl-pds,.markdown .pl-s,.markdown .pl-s .pl-pse .pl-s1,.markdown .pl-sr,.markdown .pl-sr .pl-cce,.markdown .pl-sr .pl-sra,.markdown .pl-sr .pl-sre{color:#032f62}.markdown .pl-smw,.markdown .pl-v{color:#e36209}.markdown .pl-bu{color:#b31d28}.markdown .pl-ii{background-color:#b31d28;color:#fafbfc}.markdown .pl-c2{background-color:#d73a49;color:#fafbfc}.markdown .pl-c2:before{content:"^M"}.markdown .pl-sr .pl-cce{color:#22863a;font-weight:700}.markdown .pl-ml{color:#735c0f}.markdown .pl-mh,.markdown .pl-mh .pl-en,.markdown .pl-ms{color:#005cc5;font-weight:700}.markdown .pl-mi{color:#24292e;font-style:italic}.markdown .pl-mb{color:#24292e;font-weight:700}.markdown .pl-md{background-color:#ffeef0;color:#b31d28}.markdown .pl-mi1{background-color:#f0fff4;color:#22863a}.markdown .pl-mc{background-color:#ffebda;color:#e36209}.markdown .pl-mi2{background-color:#005cc5;color:#f6f8fa}.markdown .pl-mdr{color:#6f42c1;font-weight:700}.markdown .pl-ba{color:#586069}.markdown .pl-sg{color:#959da5}.markdown .pl-corl{color:#032f62;text-decoration:underline}.markdown .mb-0{margin-bottom:0!important}.markdown .my-2{margin-bottom:8px!important;margin-top:8px!important}.markdown .pl-0{padding-left:0!important}.markdown .py-0{padding-bottom:0!important;padding-top:0!important}.markdown .pl-1{padding-left:4px!important}.markdown .pl-2{padding-left:8px!important}.markdown .py-2{padding-bottom:8px!important;padding-top:8px!important}.markdown .pl-3{padding-left:16px!important}.markdown .pl-4{padding-left:24px!important}.markdown .pl-5{padding-left:32px!important}.markdown .pl-6{padding-left:40px!important}.markdown .pl-7{padding-left:48px!important}.markdown .pl-8{padding-left:64px!important}.markdown .pl-9{padding-left:80px!important}.markdown .pl-10{padding-left:96px!important}.markdown .pl-11{padding-left:112px!important}.markdown .pl-12{padding-left:128px!important}.markdown hr{border-bottom-color:#eee}.markdown kbd{background-color:#fafbfc;border:1px solid #d1d5da;border-radius:3px;box-shadow:inset 0 -1px 0 #d1d5da;color:#444d56;display:inline-block;font:11px SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;line-height:10px;padding:3px 5px;vertical-align:middle}.markdown:after,.markdown:before{content:"";display:table}.markdown:after{clear:both}.markdown>:first-child{margin-top:0!important}.markdown>:last-child{margin-bottom:0!important}.markdown a:not([href]){color:inherit;text-decoration:none}.markdown blockquote,.markdown details,.markdown dl,.markdown ol,.markdown p,.markdown pre,.markdown table,.markdown ul{margin-bottom:16px;margin-top:0}.markdown hr{background-color:var(--markdown-border-color);border:0;height:.25em;margin:24px 0;padding:0}.markdown blockquote{border-left:.25em solid var(--markdown-blockquote-border-color);color:#6a737d;padding:0 1em}.markdown blockquote>:first-child{margin-top:0}.markdown blockquote>:last-child{margin-bottom:0}.markdown h1,.markdown h2,.markdown h3,.markdown h4,.markdown h5,.markdown h6{font-weight:600;line-height:1.25;margin-bottom:16px;margin-top:24px}.markdown h1{font-size:2em}.markdown h2{font-size:1.5em}.markdown h3{font-size:1.25em}.markdown h4{font-size:1em}.markdown h5{font-size:.875em}.markdown h6{color:#6a737d;font-size:.85em}.markdown ol,.markdown ul{padding-left:2em}.markdown ol ol,.markdown ol ul,.markdown ul ol,.markdown ul ul{margin-bottom:0;margin-top:0}.markdown ol{list-style-type:decimal}.markdown ul{list-style-type:disc}.markdown li{word-wrap:break-all;display:list-item;text-align:-webkit-match-parent}.markdown li>p{margin-top:16px}.markdown li+li{margin-top:.25em}.markdown dl{padding:0}.markdown dl dt{font-size:1em;font-style:italic;font-weight:600;margin-top:16px;padding:0}.markdown dl dd{margin-bottom:16px;padding:0 16px}.markdown table{display:block;overflow:auto;width:100%}.markdown table th{font-weight:600}.markdown table td,.markdown table th{border:1px solid var(--markdown-table-border-color);padding:6px 13px}.markdown table tr{border-top:1px solid var(--markdown-table-border-color)}.markdown table tr:nth-child(2n){background-color:var(--markdown-table-even-cell-background-color)}.markdown img{background-color:transparent;box-sizing:initial;display:block;margin:0 auto;max-width:100%}.markdown img[align=right]{padding-left:20px}.markdown img[align=left]{padding-right:20px}.markdown code{background-color:rgba(27,31,35,.05);border-radius:3px;font-size:85%;margin:0;padding:.2em .4em}.markdown pre{word-wrap:normal}.markdown pre>code{background:transparent;border:0;font-size:100%;margin:0;padding:0;white-space:pre;word-break:normal}.markdown .highlight{margin-bottom:16px}.markdown .highlight pre{margin-bottom:0;word-break:normal}.markdown .highlight pre,.markdown pre{background-color:#f6f8fa;border-radius:3px;font-size:85%;line-height:1.45;overflow:auto;padding:16px}.markdown pre code{word-wrap:normal;background-color:initial;border:0;display:inline;line-height:inherit;margin:0;max-width:auto;overflow:visible;padding:0}.markdown .commit-tease-sha{color:#444d56;display:inline-block;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;font-size:90%}.markdown .full-commit .btn-outline:not(:disabled):hover{border-color:#005cc5;color:#005cc5}.markdown .blob-wrapper{overflow-x:auto;overflow-y:hidden}.markdown .blob-wrapper-embedded{max-height:240px;overflow-y:auto}.markdown .blob-num{color:rgba(27,31,35,.3);cursor:pointer;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;font-size:12px;line-height:20px;min-width:50px;padding-left:10px;padding-right:10px;text-align:right;-webkit-user-select:none;-ms-user-select:none;user-select:none;vertical-align:top;white-space:nowrap;width:1%}.markdown .blob-num:hover{color:rgba(27,31,35,.6)}.markdown .blob-num:before{content:attr(data-line-number)}.markdown .blob-code{line-height:20px;padding-left:10px;padding-right:10px;position:relative;vertical-align:top}.markdown .blob-code-inner{word-wrap:normal;color:#24292e;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;font-size:12px;overflow:visible;white-space:pre}.markdown .pl-token.active,.markdown .pl-token:hover{background:#ffea7f;cursor:pointer}.markdown .tab-size[data-tab-size="1"]{-o-tab-size:1;tab-size:1}.markdown .tab-size[data-tab-size="2"]{-o-tab-size:2;tab-size:2}.markdown .tab-size[data-tab-size="3"]{-o-tab-size:3;tab-size:3}.markdown .tab-size[data-tab-size="4"]{-o-tab-size:4;tab-size:4}.markdown .tab-size[data-tab-size="5"]{-o-tab-size:5;tab-size:5}.markdown .tab-size[data-tab-size="6"]{-o-tab-size:6;tab-size:6}.markdown .tab-size[data-tab-size="7"]{-o-tab-size:7;tab-size:7}.markdown .tab-size[data-tab-size="8"]{-o-tab-size:8;tab-size:8}.markdown .tab-size[data-tab-size="9"]{-o-tab-size:9;tab-size:9}.markdown .tab-size[data-tab-size="10"]{-o-tab-size:10;tab-size:10}.markdown .tab-size[data-tab-size="11"]{-o-tab-size:11;tab-size:11}.markdown .tab-size[data-tab-size="12"]{-o-tab-size:12;tab-size:12}.markdown .task-list-item{list-style-type:none}.markdown .task-list-item+.task-list-item{margin-top:3px}.markdown .task-list-item input{margin:0 .2em .25em -1.6em;vertical-align:middle}.markdown .table-of-contents{align-items:flex-start;display:flex;flex-direction:column;justify-content:center;position:fixed;right:0;top:75px;width:340px}@media(max-width:1300px){.markdown .table-of-contents{display:none}}.markdown .table-of-contents ul{cursor:pointer;list-style-type:none}.markdown .table-of-contents ul li a{border-bottom:none;color:var(--secondary-text-color);font-size:14px;height:30px;padding:6px 2px;width:100%}.markdown .table-of-contents ul p{margin:0}.markdown .gatsby-resp-image-wrapper{display:flex!important;justify-content:center!important;max-height:560px!important;width:100%!important}.markdown .gatsby-resp-image-wrapper img{height:auto!important;max-height:560px!important;max-width:100%!important;position:relative!important;width:auto!important}.markdown .gatsby-resp-image-wrapper+em{color:#6a737d;display:block;font-size:15px;font-style:italic;text-align:center}code[class*=language-],pre[class*=language-]{word-wrap:normal;background:none;color:#ccc;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;font-size:1em;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none;line-height:1.5;-o-tab-size:4;tab-size:4;text-align:left;white-space:pre;word-break:normal;word-spacing:normal}pre[class*=language-]{margin:.5em 0;overflow:auto;padding:1em}:not(pre)>code[class*=language-],pre[class*=language-]{background:#2d2d2d}:not(pre)>code[class*=language-]{border-radius:.3em;padding:.1em;white-space:normal}.token.block-comment,.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#999}.token.punctuation{color:#ccc}.token.attr-name,.token.deleted,.token.namespace,.token.tag{color:#e2777a}.token.function-name{color:#6196cc}.token.boolean,.token.function,.token.number{color:#f08d49}.token.class-name,.token.constant,.token.property,.token.symbol{color:#f8c555}.token.atrule,.token.builtin,.token.important,.token.keyword,.token.selector{color:#cc99cd}.token.attr-value,.token.char,.token.regex,.token.string,.token.variable{color:#7ec699}.token.entity,.token.operator,.token.url{color:#67cdcc}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}.token.inserted{color:green}.post-content{margin-bottom:20px;width:100%}.category-page-header-wrapper,.post-content{display:flex;flex-direction:column;justify-content:center}.category-page-header-wrapper{align-items:center;margin-bottom:30px;margin-top:30px}.category-page-header-wrapper .category-page-title{border-bottom:3px solid var(--primary-text-color);font-size:40px;font-weight:700;margin-bottom:15px;padding-bottom:7px;text-align:center;width:-webkit-fit-content;width:-moz-fit-content;width:fit-content}.category-page-header-wrapper .category-page-subtitle{font-size:20px;font-weight:500;padding-bottom:10px;text-align:center}.post-card-wrapper{display:flex;justify-content:center;min-height:150px;width:100%}.post-card-wrapper .post-card{border:1px solid var(--post-card-border-color);border-radius:6px;color:var(--primary-text-color);cursor:pointer;display:flex;flex-direction:column;height:100%;margin-bottom:15px;max-width:720px;padding:15px;transition:-webkit-transform .2s;transition:transform .2s;transition:transform .2s,-webkit-transform .2s;width:100%}.post-card-wrapper .post-card:hover .title{text-decoration:underline}@media(min-width:768px){.post-card-wrapper .post-card{margin-bottom:0}}.post-card-wrapper .post-card .title{font-size:18px;font-weight:600;line-height:1.4;margin-bottom:7px}.post-card-wrapper .post-card .description{-webkit-line-clamp:3;-webkit-box-orient:vertical;color:var(--primary-text-color);display:-webkit-box;font-size:13px;line-height:20px;margin-bottom:10px;overflow:hidden;text-overflow:ellipsis}.post-card-wrapper .post-card .info{color:var(--about-link-icon-color);display:flex;font-size:14px;justify-content:space-between;margin-top:auto}.post-card-wrapper .post-card .info .categories{display:flex}.post-card-wrapper .post-card .info .categories .category{margin-left:4px}.post-card-wrapper .post-card .info .categories .category:hover{text-decoration:underline}.post-card-column-wrapper{display:flex;justify-content:center;width:100%}.post-card-column-wrapper .post-card-column{align-items:center;display:flex;flex-direction:column;width:100%}.post-card-column-wrapper .post-card-column .post-card-wrapper{margin-bottom:10px}.post-card-column-wrapper .post-card-column .more-post-card-button{background-color:var(--button-background-color);color:var(--tab-hover-text-color);font-size:15px;font-weight:500;height:40px}.post-tabs-wrapper{align-self:flex-start;display:flex;flex-direction:column;justify-content:center;top:0;width:100%}.post-tabs-wrapper .post-tabs{display:flex;height:40px;justify-content:center;margin-bottom:12px;max-width:760px;width:100%}.post-tabs-wrapper .post-tabs .mui-tabs .MuiTab-root{color:var(--tab-text-color);font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Helvetica,Arial,sans-serif,Apple Color Emoji,Segoe UI Emoji;font-size:17px;font-weight:500;height:40px;min-height:auto;min-width:auto;padding:10px 12px;transition:all .2s ease}.post-tabs-wrapper .post-tabs .mui-tabs .Mui-selected,.post-tabs-wrapper .post-tabs .mui-tabs .MuiTab-root :hover{color:var(--tab-hover-text-color);transition:all .2s ease}.post-tabs-wrapper .post-tabs .mui-tabs .Mui-selected{background-color:var(--tab-selected-background-color);border-radius:8px;font-weight:600}.post-tabs-wrapper .post-tabs .mui-tabs .MuiTabScrollButton-root{height:40px;width:20px}.post-tabs-wrapper .post-tabs .mui-tabs .MuiTabs-scrollable{height:40px}.post-tabs-wrapper .post-tabs .mui-tabs .MuiTabs-indicator{display:none}</style><style data-emotion="css-global o6gwfi">html{-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;box-sizing:border-box;-webkit-text-size-adjust:100%;}*,*::before,*::after{box-sizing:inherit;}strong,b{font-weight:700;}body{margin:0;color:rgba(0, 0, 0, 0.87);font-family:"Roboto","Helvetica","Arial",sans-serif;font-weight:400;font-size:1rem;line-height:1.5;letter-spacing:0.00938em;background-color:#fff;}@media print{body{background-color:#fff;}}body::backdrop{background-color:#fff;}</style><style data-emotion="css-global 1prfaxn">@-webkit-keyframes mui-auto-fill{from{display:block;}}@keyframes mui-auto-fill{from{display:block;}}@-webkit-keyframes mui-auto-fill-cancel{from{display:block;}}@keyframes mui-auto-fill-cancel{from{display:block;}}</style><style data-emotion="css 1l6di18 feqhe6 11tfndm mnn31 vubbuv 1yxmbwk 6flbmm">.css-1l6di18.Mui-focused .MuiAutocomplete-clearIndicator{visibility:visible;}@media (pointer: fine){.css-1l6di18:hover .MuiAutocomplete-clearIndicator{visibility:visible;}}.css-1l6di18 .MuiAutocomplete-tag{margin:3px;max-width:calc(100% - 6px);}.css-1l6di18 .MuiAutocomplete-inputRoot{-webkit-box-flex-wrap:wrap;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;}.MuiAutocomplete-hasPopupIcon.css-1l6di18 .MuiAutocomplete-inputRoot,.MuiAutocomplete-hasClearIcon.css-1l6di18 .MuiAutocomplete-inputRoot{padding-right:30px;}.MuiAutocomplete-hasPopupIcon.MuiAutocomplete-hasClearIcon.css-1l6di18 .MuiAutocomplete-inputRoot{padding-right:56px;}.css-1l6di18 .MuiAutocomplete-inputRoot .MuiAutocomplete-input{width:0;min-width:30px;}.css-1l6di18 .MuiInput-root{padding-bottom:1px;}.css-1l6di18 .MuiInput-root .MuiInput-input{padding:4px 4px 4px 0px;}.css-1l6di18 .MuiInput-root.MuiInputBase-sizeSmall .MuiInput-input{padding:2px 4px 3px 0;}.css-1l6di18 .MuiOutlinedInput-root{padding:9px;}.MuiAutocomplete-hasPopupIcon.css-1l6di18 .MuiOutlinedInput-root,.MuiAutocomplete-hasClearIcon.css-1l6di18 .MuiOutlinedInput-root{padding-right:39px;}.MuiAutocomplete-hasPopupIcon.MuiAutocomplete-hasClearIcon.css-1l6di18 .MuiOutlinedInput-root{padding-right:65px;}.css-1l6di18 .MuiOutlinedInput-root .MuiAutocomplete-input{padding:7.5px 4px 7.5px 6px;}.css-1l6di18 .MuiOutlinedInput-root .MuiAutocomplete-endAdornment{right:9px;}.css-1l6di18 .MuiOutlinedInput-root.MuiInputBase-sizeSmall{padding:6px;}.css-1l6di18 .MuiOutlinedInput-root.MuiInputBase-sizeSmall .MuiAutocomplete-input{padding:2.5px 4px 2.5px 6px;}.css-1l6di18 .MuiFilledInput-root{padding-top:19px;padding-left:8px;}.MuiAutocomplete-hasPopupIcon.css-1l6di18 .MuiFilledInput-root,.MuiAutocomplete-hasClearIcon.css-1l6di18 .MuiFilledInput-root{padding-right:39px;}.MuiAutocomplete-hasPopupIcon.MuiAutocomplete-hasClearIcon.css-1l6di18 .MuiFilledInput-root{padding-right:65px;}.css-1l6di18 .MuiFilledInput-root .MuiFilledInput-input{padding:7px 4px;}.css-1l6di18 .MuiFilledInput-root .MuiAutocomplete-endAdornment{right:9px;}.css-1l6di18 .MuiFilledInput-root.MuiInputBase-sizeSmall{padding-bottom:1px;}.css-1l6di18 .MuiFilledInput-root.MuiInputBase-sizeSmall .MuiFilledInput-input{padding:2.5px 4px;}.css-1l6di18 .MuiInputBase-hiddenLabel{padding-top:8px;}.css-1l6di18 .MuiAutocomplete-input{-webkit-box-flex:1;-webkit-flex-grow:1;-ms-flex-positive:1;flex-grow:1;text-overflow:ellipsis;opacity:1;}.css-feqhe6{display:-webkit-inline-box;display:-webkit-inline-flex;display:-ms-inline-flexbox;display:inline-flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;position:relative;min-width:0;padding:0;margin:0;border:0;vertical-align:top;width:100%;}.css-11tfndm{font-family:"Roboto","Helvetica","Arial",sans-serif;font-weight:400;font-size:1rem;line-height:1.4375em;letter-spacing:0.00938em;color:rgba(0, 0, 0, 0.87);box-sizing:border-box;position:relative;cursor:text;display:-webkit-inline-box;display:-webkit-inline-flex;display:-ms-inline-flexbox;display:inline-flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;width:100%;position:relative;}.css-11tfndm.Mui-disabled{color:rgba(0, 0, 0, 0.38);cursor:default;}label+.css-11tfndm{margin-top:16px;}.css-11tfndm:after{border-bottom:2px solid #1976d2;left:0;bottom:0;content:"";position:absolute;right:0;-webkit-transform:scaleX(0);-moz-transform:scaleX(0);-ms-transform:scaleX(0);transform:scaleX(0);-webkit-transition:-webkit-transform 200ms cubic-bezier(0.0, 0, 0.2, 1) 0ms;transition:transform 200ms cubic-bezier(0.0, 0, 0.2, 1) 0ms;pointer-events:none;}.css-11tfndm.Mui-focused:after{-webkit-transform:scaleX(1);-moz-transform:scaleX(1);-ms-transform:scaleX(1);transform:scaleX(1);}.css-11tfndm.Mui-error:after{border-bottom-color:#d32f2f;-webkit-transform:scaleX(1);-moz-transform:scaleX(1);-ms-transform:scaleX(1);transform:scaleX(1);}.css-11tfndm:before{border-bottom:1px solid rgba(0, 0, 0, 0.42);left:0;bottom:0;content:"\00a0";position:absolute;right:0;-webkit-transition:border-bottom-color 200ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;transition:border-bottom-color 200ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;pointer-events:none;}.css-11tfndm:hover:not(.Mui-disabled):before{border-bottom:2px solid rgba(0, 0, 0, 0.87);}@media (hover: none){.css-11tfndm:hover:not(.Mui-disabled):before{border-bottom:1px solid rgba(0, 0, 0, 0.42);}}.css-11tfndm.Mui-disabled:before{border-bottom-style:dotted;}.css-mnn31{font:inherit;letter-spacing:inherit;color:currentColor;padding:4px 0 5px;border:0;box-sizing:content-box;background:none;height:1.4375em;margin:0;-webkit-tap-highlight-color:transparent;display:block;min-width:0;width:100%;-webkit-animation-name:mui-auto-fill-cancel;animation-name:mui-auto-fill-cancel;-webkit-animation-duration:10ms;animation-duration:10ms;}.css-mnn31::-webkit-input-placeholder{color:currentColor;opacity:0.42;-webkit-transition:opacity 200ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;transition:opacity 200ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;}.css-mnn31::-moz-placeholder{color:currentColor;opacity:0.42;-webkit-transition:opacity 200ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;transition:opacity 200ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;}.css-mnn31:-ms-input-placeholder{color:currentColor;opacity:0.42;-webkit-transition:opacity 200ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;transition:opacity 200ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;}.css-mnn31::-ms-input-placeholder{color:currentColor;opacity:0.42;-webkit-transition:opacity 200ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;transition:opacity 200ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;}.css-mnn31:focus{outline:0;}.css-mnn31:invalid{box-shadow:none;}.css-mnn31::-webkit-search-decoration{-webkit-appearance:none;}label[data-shrink=false]+.MuiInputBase-formControl .css-mnn31::-webkit-input-placeholder{opacity:0!important;}label[data-shrink=false]+.MuiInputBase-formControl .css-mnn31::-moz-placeholder{opacity:0!important;}label[data-shrink=false]+.MuiInputBase-formControl .css-mnn31:-ms-input-placeholder{opacity:0!important;}label[data-shrink=false]+.MuiInputBase-formControl .css-mnn31::-ms-input-placeholder{opacity:0!important;}label[data-shrink=false]+.MuiInputBase-formControl .css-mnn31:focus::-webkit-input-placeholder{opacity:0.42;}label[data-shrink=false]+.MuiInputBase-formControl .css-mnn31:focus::-moz-placeholder{opacity:0.42;}label[data-shrink=false]+.MuiInputBase-formControl .css-mnn31:focus:-ms-input-placeholder{opacity:0.42;}label[data-shrink=false]+.MuiInputBase-formControl .css-mnn31:focus::-ms-input-placeholder{opacity:0.42;}.css-mnn31.Mui-disabled{opacity:1;-webkit-text-fill-color:rgba(0, 0, 0, 0.38);}.css-mnn31:-webkit-autofill{-webkit-animation-duration:5000s;animation-duration:5000s;-webkit-animation-name:mui-auto-fill;animation-name:mui-auto-fill;}.css-vubbuv{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;width:1em;height:1em;display:inline-block;fill:currentColor;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;-webkit-transition:fill 200ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;transition:fill 200ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;font-size:1.5rem;}.css-1yxmbwk{display:-webkit-inline-box;display:-webkit-inline-flex;display:-ms-inline-flexbox;display:inline-flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;position:relative;box-sizing:border-box;-webkit-tap-highlight-color:transparent;background-color:transparent;outline:0;border:0;margin:0;border-radius:0;padding:0;cursor:pointer;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;vertical-align:middle;-moz-appearance:none;-webkit-appearance:none;-webkit-text-decoration:none;text-decoration:none;color:inherit;text-align:center;-webkit-flex:0 0 auto;-ms-flex:0 0 auto;flex:0 0 auto;font-size:1.5rem;padding:8px;border-radius:50%;overflow:visible;color:rgba(0, 0, 0, 0.54);-webkit-transition:background-color 150ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;transition:background-color 150ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;}.css-1yxmbwk::-moz-focus-inner{border-style:none;}.css-1yxmbwk.Mui-disabled{pointer-events:none;cursor:default;}@media print{.css-1yxmbwk{-webkit-print-color-adjust:exact;color-adjust:exact;}}.css-1yxmbwk:hover{background-color:rgba(0, 0, 0, 0.04);}@media (hover: none){.css-1yxmbwk:hover{background-color:transparent;}}.css-1yxmbwk.Mui-disabled{background-color:transparent;color:rgba(0, 0, 0, 0.26);}.css-6flbmm{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;width:1em;height:1em;display:inline-block;fill:currentColor;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;-webkit-transition:fill 200ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;transition:fill 200ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;font-size:2.1875rem;}</style><link rel="preconnect" href="https://www.google-analytics.com"/><link rel="dns-prefetch" href="https://www.google-analytics.com"/><script>
  
  function gaOptout(){document.cookie=disableStr+'=true; expires=Thu, 31 Dec 2099 23:59:59 UTC;path=/',window[disableStr]=!0}var gaProperty='0',disableStr='ga-disable-'+gaProperty;document.cookie.indexOf(disableStr+'=true')>-1&&(window[disableStr]=!0);
  if(true) {
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  }
  if (typeof ga === "function") {
    ga('create', '0', 'auto', {});
      ga('set', 'anonymizeIp', true);
      
      
      
      
      }</script><link rel="icon" href="/favicon-32x32.png?v=ad9e124e5060ab5ddbaf24744e1cfc72" type="image/png"/><link rel="manifest" href="/manifest.webmanifest" crossorigin="anonymous"/><link rel="apple-touch-icon" sizes="48x48" href="/icons/icon-48x48.png?v=ad9e124e5060ab5ddbaf24744e1cfc72"/><link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png?v=ad9e124e5060ab5ddbaf24744e1cfc72"/><link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png?v=ad9e124e5060ab5ddbaf24744e1cfc72"/><link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png?v=ad9e124e5060ab5ddbaf24744e1cfc72"/><link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png?v=ad9e124e5060ab5ddbaf24744e1cfc72"/><link rel="apple-touch-icon" sizes="256x256" href="/icons/icon-256x256.png?v=ad9e124e5060ab5ddbaf24744e1cfc72"/><link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png?v=ad9e124e5060ab5ddbaf24744e1cfc72"/><link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png?v=ad9e124e5060ab5ddbaf24744e1cfc72"/><style type="text/css">
    .anchor.before {
      position: absolute;
      top: 0;
      left: 0;
      transform: translateX(-100%);
      padding-right: 4px;
    }
    .anchor.after {
      display: inline-block;
      padding-left: 4px;
    }
    h1 .anchor svg,
    h2 .anchor svg,
    h3 .anchor svg,
    h4 .anchor svg,
    h5 .anchor svg,
    h6 .anchor svg {
      visibility: hidden;
    }
    h1:hover .anchor svg,
    h2:hover .anchor svg,
    h3:hover .anchor svg,
    h4:hover .anchor svg,
    h5:hover .anchor svg,
    h6:hover .anchor svg,
    h1 .anchor:focus svg,
    h2 .anchor:focus svg,
    h3 .anchor:focus svg,
    h4 .anchor:focus svg,
    h5 .anchor:focus svg,
    h6 .anchor:focus svg {
      visibility: visible;
    }
  </style><script>
    document.addEventListener("DOMContentLoaded", function(event) {
      var hash = window.decodeURI(location.hash.replace('#', ''))
      if (hash !== '') {
        var element = document.getElementById(hash)
        if (element) {
          var scrollTop = window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop
          var clientTop = document.documentElement.clientTop || document.body.clientTop || 0
          var offset = element.getBoundingClientRect().top + scrollTop - clientTop
          // Wait for the browser to finish rendering before scrolling.
          setTimeout((function() {
            window.scrollTo(0, offset - 0)
          }), 0)
        }
      }
    })
  </script><title data-react-helmet="true">TIL - LSM(Linux Security Module)</title><link rel="preload" as="font" type="font/woff2" crossorigin="anonymous" href="/static/webfonts/s/roboto/v30/KFOlCnqEu92Fr1MmSU5fBBc4.woff2"/><link rel="preload" as="font" type="font/woff2" crossorigin="anonymous" href="/static/webfonts/s/roboto/v30/KFOmCnqEu92Fr1Mu4mxK.woff2"/><link rel="preload" as="font" type="font/woff2" crossorigin="anonymous" href="/static/webfonts/s/roboto/v30/KFOlCnqEu92Fr1MmEU9fBBc4.woff2"/><style>@font-face{font-display:swap;font-family:Roboto;font-style:normal;font-weight:300;src:url(/static/webfonts/s/roboto/v30/KFOlCnqEu92Fr1MmSU5fBBc4.woff2) format("woff2")}@font-face{font-display:swap;font-family:Roboto;font-style:normal;font-weight:400;src:url(/static/webfonts/s/roboto/v30/KFOmCnqEu92Fr1Mu4mxK.woff2) format("woff2")}@font-face{font-display:swap;font-family:Roboto;font-style:normal;font-weight:500;src:url(/static/webfonts/s/roboto/v30/KFOlCnqEu92Fr1MmEU9fBBc4.woff2) format("woff2")}@font-face{font-display:swap;font-family:Roboto;font-style:normal;font-weight:300;src:url(/static/webfonts/s/roboto/v30/KFOlCnqEu92Fr1MmSU5fBBc-.woff) format("woff")}@font-face{font-display:swap;font-family:Roboto;font-style:normal;font-weight:400;src:url(/static/webfonts/s/roboto/v30/KFOmCnqEu92Fr1Mu4mxM.woff) format("woff")}@font-face{font-display:swap;font-family:Roboto;font-style:normal;font-weight:500;src:url(/static/webfonts/s/roboto/v30/KFOlCnqEu92Fr1MmEU9fBBc-.woff) format("woff")}</style><link rel="sitemap" type="application/xml" href="/sitemap.xml"/><style>.gatsby-image-wrapper{position:relative;overflow:hidden}.gatsby-image-wrapper picture.object-fit-polyfill{position:static!important}.gatsby-image-wrapper img{bottom:0;height:100%;left:0;margin:0;max-width:none;padding:0;position:absolute;right:0;top:0;width:100%;object-fit:cover}.gatsby-image-wrapper [data-main-image]{opacity:0;transform:translateZ(0);transition:opacity .25s linear;will-change:opacity}.gatsby-image-wrapper-constrained{display:inline-block;vertical-align:top}</style><noscript><style>.gatsby-image-wrapper noscript [data-main-image]{opacity:1!important}.gatsby-image-wrapper [data-placeholder-image]{opacity:0!important}</style></noscript><script type="module">const e="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;e&&document.body.addEventListener("load",(function(e){if(void 0===e.target.dataset.mainImage)return;if(void 0===e.target.dataset.gatsbyImageSsr)return;const t=e.target;let a=null,n=t;for(;null===a&&n;)void 0!==n.parentNode.dataset.gatsbyImageWrapper&&(a=n.parentNode),n=n.parentNode;const o=a.querySelector("[data-placeholder-image]"),r=new Image;r.src=t.currentSrc,r.decode().catch((()=>{})).then((()=>{t.style.opacity=1,o&&(o.style.opacity=0,o.style.transition="opacity 500ms linear")}))}),!0);</script><link as="script" rel="preload" href="/webpack-runtime-11fab238ab053aae2627.js"/><link as="script" rel="preload" href="/framework-043f1197be387cb18d15.js"/><link as="script" rel="preload" href="/app-2a3abbc7799f752aeec3.js"/><link as="script" rel="preload" href="/f9d3028dbef90a6e9b8db85387d63dd9f4edf538-064f8125dbb44e660b41.js"/><link as="script" rel="preload" href="/component---src-templates-blog-template-js-dc3d26b2be7d8f1b7ec9.js"/><link as="fetch" rel="preload" href="/page-data/TIL/LSM/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/1073350324.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/1956554647.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/2938748437.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/app-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div class="page-wrapper"><header class="page-header-wrapper"><div class="page-header"><div class="front-section"><a class="link" href="/">sominsong.github.io</a></div><div class="trailing-section"><a class="link" href="/about">about</a><a class="link" href="/posts">posts</a><div class="MuiAutocomplete-root MuiAutocomplete-hasPopupIcon css-1l6di18" role="combobox" aria-expanded="false"><div class="search-input-wrapper"><div class="MuiFormControl-root MuiFormControl-fullWidth MuiTextField-root search-input css-feqhe6"><div class="MuiInput-root MuiInput-underline MuiInputBase-root MuiInputBase-colorPrimary MuiInputBase-fullWidth MuiInputBase-formControl MuiInputBase-adornedEnd MuiAutocomplete-inputRoot css-11tfndm"><input type="text" aria-invalid="false" autoComplete="off" value="" class="MuiInput-input MuiInputBase-input MuiInputBase-inputAdornedEnd MuiAutocomplete-input MuiAutocomplete-inputFocused css-mnn31" aria-autocomplete="list" autoCapitalize="none" spellcheck="false"/><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeMedium search-icon css-vubbuv" focusable="false" viewBox="0 0 24 24" aria-hidden="true" data-testid="SearchOutlinedIcon"><path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"></path></svg></div></div></div></div></div></div></header><main class="page-content"><header class="post-header"><div class="emoji">📖</div><div class="info"><div class="categories"><a class="category" href="/posts/TIL">TIL</a><a class="category" href="/posts/Linux">Linux</a></div></div><h1 class="title">TIL - LSM(Linux Security Module)</h1><div class="info"><div class="author">posted by <strong>Mini</strong>,</div> <!-- -->October 26, 2022</div></header><div class="post-content"><div class="markdown"><h2 id="0-lsm-linux-security-module" style="position:relative;"><a href="#0-lsm-linux-security-module" aria-label="0 lsm linux security module permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>0. LSM (Linux Security Module)</h2>
<p>Linux Security Module(LSM) 프레임워크는 Security Module을 지원하는 커널 프레임워크를 제공한다.
특히, LSM은 리눅스에서 MAC(Mandatory Access Control; 강제 접근 제어)을 구현하는데 중점을 두고 있지만, 향후에는 샌드박싱과 같은 다른 보안 요구 사항을 해결할 수 있다.</p>
<p>LSM 프레임워크 그 자체로는 추가적인 보안 기능을 제공하지는 않는다. 다만, Security Module을 지원하기 위한 인프라를 제공할 뿐이다.
LSM은 매번 커널 소스 코드를 구정할 필요 없이 MAC을 구현하기 위한 필수적인 컴포넌트들을 제공한다.
이러한 LSM을 활용하면 application whitelist를 쉽고 편리하게 구현할 수 있다.</p>
<p>LSM 프레임워크는 리눅스 커널 곳곳에 Hook을 넣어 커널에서 발생하는 여러 민감한 동작 부분에서 Hook을 Security Module에게 제공하고,
해당 동작의 허용 여부를 Security Module이 결정할 수 있도록 만드는 Inteface 역할만을 수행한다.
따라서, 실제 정책이 수행되는 곳은 Security Module이며, LSM은 커널이 실행되는 과정에서 Hook을 통해 Security Module의 Hook funtion을 호출하는 역할만을 수행한다.</p>
<p>즉, Seucity Module은 이러한 hook을 사용해서 액세스를 제어하는 독립적인 커널 모듈로 사용되며, Security Module의 Hook function은 inode, tasks, files, devices, IPC와 같은 내부 커널 object에 대한 접근을 통제한다.
해당 Hook 함수 내부에서 정책에 따라 Allow/Deny를 반환하면, 반환된 결과에 따라 프로세스를 계속 실행하거나 중단하게 된다.</p>
<p>Capability, AppArmor, SELinux, Smack, TOMOYO가 이러한 Security Module의 예이며, 현재 시스템에서 활성화된 Security Module은 <code class="language-text">/sys/kernel/security/lsm</code> 파일을 통해 아래와 같이 확인할 수 있다.</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">mini@bastion:~$ <span class="token function">cat</span> /sys/kernel/security/lsm 
lockdown,capability,yama,apparmor<span class="token punctuation">(</span>base<span class="token punctuation">)</span></code></pre></div>
<p>이름이 module이라고해서 <code class="language-text">lsmod</code> 명령으로 조회 가능한 loadable module이 아니다.
Security Module은 커널이 컴파일될 때 함께 컴파일 되어야한다.</p>
<h3 id="dacs-vs-macs" style="position:relative;"><a href="#dacs-vs-macs" aria-label="dacs vs macs permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>DACs vs. MACs</h3>
<p>두 방법 모두에게 들어가는 AC란 Access Control, 즉 접근 제어를 의미한다.
접근 제어란 디렉터리나 파일, 네트워크 소켓과 같은 시스템 리소스를 적절한 권한을 가진 사용자나 그룹만 접근하고 이를 사용할 수 있도록 통제하는 것을 의미한다.
이러한 접근 제어 모델에서 시스템 리소스를 객체(Object)라고 하며, 이 자원에 접근하려고 하는 유저나 프로세스는 주체(Subject)라고 정의한다.</p>
<p>예를 들어, <code class="language-text">/etc/passwd</code> 파일은 객체이고 이 파일에 접근해서 암호를 변경하는 <code class="language-text">passwd</code> 명령어 프로세스는 주체가 되는 것이다.</p>
<h4 id="dacs" style="position:relative;"><a href="#dacs" aria-label="dacs permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>DACs</h4>
<p>DAC(Discretionary Access Control; 임의 접근 제어) 기반 접근 제어는 주체나 그룹의 identity(신분)를 기반으로 object에 대한 접근을 제한하는 방법이다.
즉, 객체의 소유자인 유저나 그룹이 다른 주체에 대해서 이 객체에 대한 접근 권한을 설정하는 방법이다.
여기서 Discretionary(임의적)이라는 단어는 바로 ‘소유자가 자신의 판단에 의해 권한을 부여할 수 있다’는 의미이다.</p>
<p>과거 수십 년동안 리눅스에서는 DAC 기반 액세스 제어를 기본 액세스 제어 모델로 사용했다.
아래와 같이 각 디렉토리와 파일에 대한 소유자, 그룹 및 permission이 그 예이다.</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">sominsong.github.io<span class="token punctuation">[</span>gh-pages<span class="token punctuation">]</span> % ll
total <span class="token number">3120</span>
-rw-r--r--     <span class="token number">1</span> mini  staff   675B <span class="token number">10</span> <span class="token number">13</span> <span class="token number">19</span>:33 LICENSE
-rw-r--r--     <span class="token number">1</span> mini  staff   <span class="token number">6</span>.4K <span class="token number">10</span> <span class="token number">13</span> <span class="token number">19</span>:33 README.en.md
-rw-r--r--     <span class="token number">1</span> mini  staff   <span class="token number">8</span>.6K <span class="token number">10</span> <span class="token number">13</span> <span class="token number">19</span>:33 README.md
drwxr-xr-x     <span class="token number">8</span> mini  staff   256B <span class="token number">10</span> <span class="token number">13</span> <span class="token number">23</span>:07 assets
drwxr-xr-x     <span class="token number">7</span> mini  staff   224B <span class="token number">10</span> <span class="token number">27</span> <span class="token number">15</span>:11 content
-rw-r--r--     <span class="token number">1</span> mini  staff    32B <span class="token number">10</span> <span class="token number">13</span> <span class="token number">19</span>:33 gatsby-browser.js
-rw-r--r--     <span class="token number">1</span> mini  staff   <span class="token number">3</span>.4K <span class="token number">10</span> <span class="token number">13</span> <span class="token number">19</span>:33 gatsby-config.js
-rw-r--r--     <span class="token number">1</span> mini  staff   <span class="token number">4</span>.7K <span class="token number">10</span> <span class="token number">26</span> 02:25 gatsby-meta-config.js
-rw-r--r--     <span class="token number">1</span> mini  staff   <span class="token number">2</span>.7K <span class="token number">10</span> <span class="token number">13</span> <span class="token number">19</span>:33 gatsby-node.js
-rw-r--r--     <span class="token number">1</span> mini  staff   124B <span class="token number">10</span> <span class="token number">13</span> <span class="token number">19</span>:33 netlify.toml
drwxr-xr-x  <span class="token number">1173</span> mini  staff    37K <span class="token number">10</span> <span class="token number">13</span> <span class="token number">19</span>:53 node_modules
-rw-r--r--     <span class="token number">1</span> mini  staff   <span class="token number">1</span>.5M <span class="token number">10</span> <span class="token number">13</span> <span class="token number">21</span>:52 package-lock.json
-rw-r--r--     <span class="token number">1</span> mini  staff   <span class="token number">2</span>.0K <span class="token number">10</span> <span class="token number">13</span> <span class="token number">21</span>:52 package.json
drwxr-xr-x    <span class="token number">68</span> mini  staff   <span class="token number">2</span>.1K <span class="token number">10</span> <span class="token number">27</span> <span class="token number">16</span>:48 public
drwxr-xr-x     <span class="token number">9</span> mini  staff   288B <span class="token number">10</span> <span class="token number">13</span> <span class="token number">19</span>:33 src
drwxr-xr-x     <span class="token number">4</span> mini  staff   128B <span class="token number">10</span> <span class="token number">13</span> <span class="token number">19</span>:33 static</code></pre></div>
<p>DAC의 문제점은 primitive(즉, 권한)이 전이성을 가진다라는 것이다.
즉, 권한 있는 유저(root)는 다른 권한 있는 유저를 생성할 수 있으며, 이렇게 생성된 유저가 제한된 개체에 액세스할 수 있다.</p>
<p>이렇게 모든 권한을 가진 <code class="language-text">root</code> 계정을 탈취하여 시스템을 장악하는 방법은 많은 공격자들이 권한을 탈취하기 위해 사용하는 방법이다.
이러한 권한 탈취에 많이 사용되는 리눅스의 구조적인 2가지 보안 취약점으로는 <code class="language-text">setuid/setgid</code> 문제가 있다.</p>
<h5 id="setuidsetgid-문제" style="position:relative;"><a href="#setuidsetgid-%EB%AC%B8%EC%A0%9C" aria-label="setuidsetgid 문제 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>setuid/setgid 문제</h5>
<p>유저들의 암호는 <code class="language-text">/etc/shadow</code> 파일에 저장되어 있으며, <code class="language-text">root</code>만이 이를 읽고 쓸 수 있다.
하지만 유저들은 <code class="language-text">passwd</code> 명령어를 실행해서 자신의 암호를 변경할 수 있고, 이 때 <code class="language-text">/etc/shadow</code> 파일이 수정된다.</p>
<p>또한, 상대방 호스트가 동작하는지 확인하기 위해 사용하는 <code class="language-text">ping</code>은 ICMP(Internet Control Message Protocol) 패킷을 사용하시 때문에 <code class="language-text">root</code> 권한이 필요하지만 일반 유저도 <code class="language-text">ping</code> 명령어를 사용해서 상대 호스트의 이상 여부를 확인할 수 있다.</p>
<p>이는 모두 <code class="language-text">setuid(set user ID upon execution)</code> 비트 또는 <code class="language-text">setgit(set group ID upon execution)</code> 비트 덕분이다.</p>
<p>유닉스 계역의 운영 체제는 실행 파일의 속성에 <code class="language-text">setuid/setgit</code> 비트를 설정할 수 있으며, 이 비트가 설정되어 있을 경우 해당 프로그램을 실행하면 실행 시점에 설정된 사용자(<code class="language-text">setuid</code>), 또는 그룹(<code class="language-text">setgid</code>) 권한으로 동작한다.</p>
<p>예를 들어 <code class="language-text">ping</code>과 <code class="language-text">passwd</code>의 파일 권한을 확인해보면 다음과 같다:</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">$ <span class="token function">ls</span> -l /bin/ping /usr/bin/passwd

-rwsr-xr-x <span class="token number">1</span> root root <span class="token number">44168</span> May  <span class="token number">8</span>  <span class="token number">2014</span> /bin/ping
-rwsr-xr-x <span class="token number">1</span> root root <span class="token number">54256</span> May <span class="token number">17</span> 08:37 /usr/bin/passwd</code></pre></div>
<blockquote>
<p>버전에 따라 <code class="language-text">ping</code>에 <code class="language-text">setuid</code> 비트가 붙지 않았을 수도 있음</p>
</blockquote>
<p>파일의 유저 permission 뿐의 <code class="language-text">s</code> 표시는 <code class="language-text">setuid</code> 비트이며, 그룹 permission 부분에 <code class="language-text">s</code> 표시가 있을 경우 <code class="language-text">setgid</code> 비트에 대한 설정이다.
소유자와 소유 그룹 모두 <code class="language-text">root</code>인 것을 확인할 수 있다.</p>
<p>즉, <code class="language-text">passwd</code>나 <code class="language-text">ping</code>은 실행시 <code class="language-text">root</code> 사용자로 전환되므로 <code class="language-text">root</code>만 가능한 동작(e.g., <code class="language-text">/etc/passwd</code> 파일 수정)을 수행할 수 있다.</p>
<p>따라서, 이렇게 <code class="language-text">setuid</code> 비트가 붙은 프로그램에 보안 취약점이 존재할 경우 <code class="language-text">root</code>로 작동 중이었기때문에 공격자가 손쉽게 <code class="language-text">root</code>권한을 탈취할 수 있다.</p>
<p>이 때문에 <code class="language-text">setuid</code> 비트는 필수적이지만, UNIX 기반 시스템의 주요 보안 취약점이 되어왔다.</p>
<p>리눅스 시스템에 있는 <code class="language-text">setuid</code> 비트(4000)과 <code class="language-text">setgid</code> 비트(2000)이 붙은 모든 프로그램은 다음 명령어로 찾을 수 있다:</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">$ <span class="token function">find</span> /bin /usr/bin /sbin -perm -4000 -o -perm -2000 <span class="token operator">|</span><span class="token function">xargs</span> <span class="token function">ls</span> -l</code></pre></div>
<h5 id="well-known-port-daemon-문제" style="position:relative;"><a href="#well-known-port-daemon-%EB%AC%B8%EC%A0%9C" aria-label="well known port daemon 문제 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Well-known port daemon 문제</h5>
<p>http의 80번 포트, 메일 서버의 smtp에 사용되는 25번 포트, 파일 전송에 사용되는 ftp의 20번, 21번 포트와 같이 well-known 포트는 특정한 쓰임새를 위해 IANA(Internet Assigned Numbers Authority; 인터넷 할당 번호 관리기관)에서 할당한 TCP 및 UDP 포트 번호이며, 1024 미만의 포트 번호를 사용하고 있다.</p>
<p>이러한 Well-known 포트는 <code class="language-text">root</code>만이 사용할 수 있기때문에, daemon 서비스는 모두 <code class="language-text">root</code>의 권한으로 실행된다.</p>
<p>따라서, 이러한 daemon에 보안 취약졈이 존재하거나 잘못된 설정이 존재할 경우 서비스 데몬을 통해서 공격자가 <code class="language-text">root</code> 권한을 탈취하게 될 위험이 있다.
때문에 웹 서버 등은 구동 직후에 자식 프로세스를 생성(<code class="language-text">fork</code> 시스템콜)한 후, 쉘이 없는 유저 계정으로 전환하여 동작하고 있다.</p>
<p>예로 아파치 웹 서버의 경우 <code class="language-text">User apache</code>, <code class="language-text">Group apache</code>로 전환될 사용자를 지정하고, nginx의 경우 <code class="language-text">user nginx;</code>로 전환될 사용자를 지정한다.</p>
<p>하지만 여전히 부모 프로세스는 계속 <code class="language-text">root</code>로 작동하고 있기 때문에 1024 미만의 포트를 사용하는 데몬 프로세스에 대한 보안 대책이 필요하게 된다.</p>
<p>그러나 이렇게 1024 미만의 포트를 일반 사용자가 쓸 수 있게 하거나 <code class="language-text">root</code>가 아닌 별도의 계정에게만 허용하는 것은 전통적인 유닉스의 동작 방식에 어긋난다.</p>
<p>이에 등장한 개념이 바로 MAC이라고 볼 수 있다.</p>
<h4 id="macs" style="position:relative;"><a href="#macs" aria-label="macs permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>MACs</h4>
<p>MAC(Mandatory Access Control; 강제 접근 제어)는 주체(e.g., 유저, 프로세서, 스레드)와 객체(e.g., 파일, 소켓, 메모리 세그먼트)에 각각 보안 등급을 부여하고, 이렇게 부여된 보안 등급을 MAC 정책을 통해 중앙에서 관리하는 방법이다.
즉, 미리 정채진 보안 정책과 보안 등급에 기반해서 주체에게 허용된 접근 권한과 객체에서 부여된 허용 등급을 비교하여 접근을 통제하는 모델이다.</p>
<p>높은 보안을 요구하는 리소스는 낮은 보안 수준의 주체가 접근할 수 없으며, 소유자라 할지라도 정책에 어긋나면 객체에 접근할 수 없으므로 보다 강력한 보안을 제공한다.</p>
<p>따라서 MAC 정책에서는 <code class="language-text">root</code>로 구동한 http 서버라할지라도 접근 가능한 파일과 포트가 제한될 수 있다.
즉, 취약점을 이용하여 httpd의 권한을 획득하더라도 사전에 httpd에게 허용한 <code class="language-text">/var/www/html</code>, <code class="language-text">/etc/httpd</code> 등의 폴더에만 접근이 가능하며, 포트 또한 80, 443, 8080 등 웹 서버에게 사전에 허용된 포트만 접근이 허용되므로 ssh를 통해 다른 서버로 접근을 시도하는 등과 같은 해킹으로 인한 이차 피해가 최소화될 수 있다.</p>
<p>MAC 메커니즘의 단점으로는 구현이 복잡하고 어려우며 모든 주체와 객체에 대해 보안 등급과 허용 등급을 부여해야 하므로 정책 설정이 복잡하기 때문에 시스템 관리자가 access control 모델에 대해 깊이 이해하고 있어야 한다.</p>
<h2 id="1-lsm-framework" style="position:relative;"><a href="#1-lsm-framework" aria-label="1 lsm framework permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>1. LSM Framework</h2>
<p>앞서 설명한 것처럼 LSM 프레임워크는 커널에 내장된 Hook을 제공하고, Security Module을 설치할 수 있도록 하는 모듈형 아키텍처를 제공함으로써 보다 강화된 Access Control을 제공한다.
LSM 프레임워크는 Access Control 메커니즘을 구현하는 Third-Party Security Module을 커널에 연결하여 리눅스의 기본 DAC 이외에 추가적인 MAC을 제공한다.</p>
<p>보다 구체적으로 LSM 프레임워크가 제공하는 기능은 다음과 같다:</p>
<ul>
<li>커널 자료 구조에 <code class="language-text">void *</code> 타입의 추가적인 security field를 추가하여 Security Module에서 이를 활용할 수 있도록 제공</li>
<li>커널 코드의 중요 지점에 Hook 함수 호출을 삽입하여 security field를 관리하고 Access Control을 수행하는 기능</li>
<li>Security Module을 등록 및 등록 취소하는 기능</li>
</ul>
<p>LSM 프레임워크의 사용은 선택 사항이며, 커널에서 <code class="language-text">CONFIG_SECURITY</code>를 활성화해야 사용할 수 있다.</p>
<h3 id="security-field" style="position:relative;"><a href="#security-field" aria-label="security field permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Security field</h3>
<p>LSM 프레임워크는 security “blobs” (다양한 커널 객체와 관련된 context 데이터)를 저장하기 위해 다양한 커널 자료 구조에 <code class="language-text">void</code> 포인터 타입의 추가적인 security field를 제공한다.
이러한 특수 필드는 이름에 <code class="language-text">security</code> 접미사를 지니며, Major Module만이 이를 사용할 수 있다.</p>
<p>아래는 커널 자료 구조 내에 삽입된 security field의 코드이다:</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token comment">// /include/linux/fs.h</span>
<span class="token keyword">struct</span> <span class="token class-name">inode</span> <span class="token punctuation">{</span>
    <span class="token comment">/* ... */</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifdef</span> <span class="token expression">CONFIG_SECURITY</span></span>
    <span class="token keyword">void</span> <span class="token operator">*</span>i_security<span class="token punctuation">;</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span>
    <span class="token comment">/* ... */</span>
<span class="token punctuation">}</span>

<span class="token comment">// /include/linux/cred.h</span>
<span class="token keyword">struct</span> <span class="token class-name">cred</span> <span class="token punctuation">{</span>
    <span class="token comment">/* ... */</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifdef</span> <span class="token expression">CONFIG_SECURITY</span></span>
    <span class="token keyword">void</span> <span class="token operator">*</span>security
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span>
    <span class="token comment">/* ... */</span>
<span class="token punctuation">}</span>

<span class="token comment">// /include/linux/sched.h</span>
<span class="token keyword">struct</span> <span class="token class-name">task_struct</span> <span class="token punctuation">{</span>
    <span class="token comment">/* ... */</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifdef</span> <span class="token expression">CONFIG_SECURITY</span></span>
    <span class="token keyword">void</span> <span class="token operator">*</span>security
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span>
    <span class="token comment">/* ... */</span>
<span class="token punctuation">}</span></code></pre></div>
<p>위와 같이 security field들이 삽입되어 있는 커널의 자료 구조는 다음과 같다:</p>
<ul>
<li>프로세스 및 프로그램: <code class="language-text">struct task_struct</code>, <code class="language-text">struct linux_binrpm</code></li>
<li>파일 시스템: <code class="language-text">struct super_block</code></li>
<li>파일, 소켓: <code class="language-text">struct inode</code>, <code class="language-text">struct file</code></li>
<li>패킷, 네트워크 디바이스: <code class="language-text">struct sk_buff</code>, <code class="language-text">struct net_device</code></li>
<li>System V IPC: <code class="language-text">struct kern_ipc_perm</code>, <code class="language-text">struct msg_msg</code></li>
</ul>
<h2 id="2-lsm-hooks" style="position:relative;"><a href="#2-lsm-hooks" aria-label="2 lsm hooks permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>2. LSM Hooks</h2>
<p>LSM hooks는 <a href="https://github.com/torvalds/linux/blob/master/include/linux/lsm_hook_defs.h"><code class="language-text">/include/linux/lsm_hook_defs.h</code></a>에서 그 목록을 확인할 수 있다.</p>
<p>LSM 프레임워크는 <code class="language-text">security_hook_heads</code>라는 구조체를 가지고 있다.</p>
<p><code class="language-text">security_hook_heads</code> 구조체는 각 Security Module의 Hook 함수로 연결되는 링크드 리스트의 Head(Hook Head)를 가지고 있으며, <code class="language-text">/include/linux/lsm_hooks.h</code>에 LSM Hook들이 다음과 같이 정의되어 있다:</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token keyword">struct</span> <span class="token class-name">security_hook_heads</span> <span class="token punctuation">{</span>
    <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name function">LSM_HOOK</span><span class="token expression"><span class="token punctuation">(</span>RET<span class="token punctuation">,</span> DEFAULT<span class="token punctuation">,</span> NAME<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span> <span class="token keyword">struct</span> <span class="token class-name">hlist_head</span> NAME<span class="token punctuation">;</span></span></span>
    <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"lsm_hook_defs.h"</span></span>
    <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">undef</span> <span class="token expression">LSM_HOOK</span></span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre></div>
<p><code class="language-text">lsm_hook_defs.h</code>를 살펴보면 다음과 같다.</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token function">LSM_HOOK</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> binder_set_context_mgr<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">struct</span> <span class="token class-name">cred</span> <span class="token operator">*</span>mgr<span class="token punctuation">)</span>
<span class="token function">LSM_HOOK</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> binder_transaction<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">struct</span> <span class="token class-name">cred</span> <span class="token operator">*</span>from<span class="token punctuation">,</span>
	 <span class="token keyword">const</span> <span class="token keyword">struct</span> <span class="token class-name">cred</span> <span class="token operator">*</span>to<span class="token punctuation">)</span>
<span class="token function">LSM_HOOK</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> binder_transfer_binder<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">struct</span> <span class="token class-name">cred</span> <span class="token operator">*</span>from<span class="token punctuation">,</span>
	 <span class="token keyword">const</span> <span class="token keyword">struct</span> <span class="token class-name">cred</span> <span class="token operator">*</span>to<span class="token punctuation">)</span>
<span class="token function">LSM_HOOK</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> binder_transfer_file<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">struct</span> <span class="token class-name">cred</span> <span class="token operator">*</span>from<span class="token punctuation">,</span>
	 <span class="token keyword">const</span> <span class="token keyword">struct</span> <span class="token class-name">cred</span> <span class="token operator">*</span>to<span class="token punctuation">,</span> <span class="token keyword">struct</span> <span class="token class-name">file</span> <span class="token operator">*</span>file<span class="token punctuation">)</span>
<span class="token function">LSM_HOOK</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> ptrace_access_check<span class="token punctuation">,</span> <span class="token keyword">struct</span> <span class="token class-name">task_struct</span> <span class="token operator">*</span>child<span class="token punctuation">,</span>
	 <span class="token keyword">unsigned</span> <span class="token keyword">int</span> mode<span class="token punctuation">)</span>
<span class="token function">LSM_HOOK</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> ptrace_traceme<span class="token punctuation">,</span> <span class="token keyword">struct</span> <span class="token class-name">task_struct</span> <span class="token operator">*</span>parent<span class="token punctuation">)</span>

<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">(</span>생략<span class="token punctuation">)</span>
</code></pre></div>
<p>이 <code class="language-text">security_hook_heads</code> 구조체는 커널의 초기화 과정에서 초기화되며, 초기화하는 함수인 <code class="language-text">early_security_init()</code>은 <code class="language-text">/security/security.c</code>에 정의되어있다.</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token keyword">int</span> __init <span class="token function">early_security_init</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">int</span> i<span class="token punctuation">;</span>
    <span class="token keyword">struct</span> <span class="token class-name">hlist_head</span> <span class="token operator">*</span>list <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">hlist_head</span> <span class="token operator">*</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span>security_hook_heads<span class="token punctuation">;</span>
    <span class="token keyword">struct</span> <span class="token class-name">lsm_info</span> <span class="token operator">*</span>lsm<span class="token punctuation">;</span>

    <span class="token keyword">for</span> <span class="token punctuation">(</span>i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>security_hook_heads<span class="token punctuation">)</span><span class="token operator">/</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">hlist_head</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
        <span class="token function">INIT_HLIST_HEAD</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>list<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>
    
    <span class="token keyword">for</span> <span class="token punctuation">(</span>lsm <span class="token operator">=</span> __start_early_lsm_infol lsm <span class="token operator">&lt;</span> __end_early_lsm_info<span class="token punctuation">;</span> lsm<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>lsm<span class="token operator">-></span>enabled<span class="token punctuation">)</span>
            lsm<span class="token operator">-></span>enabled <span class="token operator">=</span> <span class="token operator">&amp;</span>lsm_enabled_true<span class="token punctuation">;</span>
        <span class="token function">prepare_lsm</span><span class="token punctuation">(</span>lsm<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">initialize_lsm</span><span class="token punctuation">(</span>lsm<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>코드에서는 <code class="language-text">security_hook_heads</code> 구조체를 초기화한 후, <code class="language-text">lsm_info</code> 구조체 속에 담겨진 Security Module을 차례로 초기화한다.
<code class="language-text">lsm_info</code>에는 커널을 빌드할 때 활성화시킨 LSM Security Module에 대한 정보가 들어있다.
즉, 각 LSM Hook에 대한 Hook Head 리스트를 생성하고, 각 보안 모듈을 해당하는 LSM Hook의 Hook Head 뒤에 attach함으로써 링크드 리스트를 만드는 것이다.</p>
<p>Capability를 제외한 나머지 Security Module의 경우, 다음과 같은 순서로 LSM에 올라가게 되며, <code class="language-text">/security/Kconfig</code>에 정의되어 있다.
이 순서는 Minor Security Module, Major Security Module 순이다.</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c">config LSM
	string <span class="token string">"Ordered list of enabled LSMs"</span>
	<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
	<span class="token keyword">default</span> <span class="token string">"landlock,lockdown,yama,loadpin,safesetid,integrity,selinux,smack,tomoyo,apparmor,bpf"</span></code></pre></div>
<p>예를 들어, AppArmor의 경우 <code class="language-text">/security/apparmor/lsm.c</code>에서 다음과 같이 정의된다.</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token function">DEFINE_LSM</span><span class="token punctuation">(</span>apparmor<span class="token punctuation">)</span><span class="token operator">=</span><span class="token punctuation">{</span>
    <span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">"apparmor"</span>
    <span class="token punctuation">.</span>flags <span class="token operator">=</span> LSM_FLAG_LEGACY_MAJOR <span class="token operator">|</span> LSM_FLAG_EXCLUSIVE<span class="token punctuation">,</span>
    <span class="token punctuation">.</span>enabled <span class="token operator">=</span> <span class="token operator">&amp;</span>apparmor_enabled<span class="token punctuation">,</span>
    <span class="token punctuation">.</span>blobs <span class="token operator">=</span> <span class="token operator">&amp;</span>apparmor_blob_sizes<span class="token punctuation">,</span>
    <span class="token punctuation">.</span>init <span class="token operator">=</span> apparmor_init<span class="token punctuation">,</span>
<span class="token punctuation">}</span></code></pre></div>
<p>초기화 함수인 <code class="language-text">apparmor_init()</code>은 다음과 같이 <code class="language-text">security_hook_list apparmor_hooks</code>를 인자로 넘겨주며 <code class="language-text">security_add_hooks()</code> 함수를 호출한다.</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token keyword">static</span> <span class="token keyword">int</span> __init <span class="token function">apparmor_init</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">/* ... */</span>

    <span class="token function">security_add_hooks</span><span class="token punctuation">(</span>apparmor_hooks<span class="token punctuation">,</span> <span class="token function">ARRAY_SIZE</span><span class="token punctuation">(</span>apparmor_hooks<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">"apparmor"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">/* ... */</span>
<span class="token punctuation">}</span></code></pre></div>
<p><code class="language-text">security_hook_list apparmor_hooks</code>는 동일한 파일에 다음과 같이 정의되어 있다.</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token keyword">static</span> <span class="token keyword">struct</span> <span class="token class-name">security_hook_list</span> apparmor_hooks<span class="token punctuation">[</span><span class="token punctuation">]</span> __lsm_ro_after_init <span class="token operator">=</span> <span class="token punctuation">{</span>
	<span class="token function">LSM_HOOK_INIT</span><span class="token punctuation">(</span>ptrace_access_check<span class="token punctuation">,</span> apparmor_ptrace_access_check<span class="token punctuation">)</span><span class="token punctuation">,</span>
	<span class="token function">LSM_HOOK_INIT</span><span class="token punctuation">(</span>ptrace_traceme<span class="token punctuation">,</span> apparmor_ptrace_traceme<span class="token punctuation">)</span><span class="token punctuation">,</span>
	<span class="token function">LSM_HOOK_INIT</span><span class="token punctuation">(</span>capget<span class="token punctuation">,</span> apparmor_capget<span class="token punctuation">)</span><span class="token punctuation">,</span>
	<span class="token function">LSM_HOOK_INIT</span><span class="token punctuation">(</span>capable<span class="token punctuation">,</span> apparmor_capable<span class="token punctuation">)</span><span class="token punctuation">,</span>
    
    <span class="token comment">/* ... */</span>
    
    <span class="token function">LSM_HOOK_INIT</span><span class="token punctuation">(</span>secid_to_secctx<span class="token punctuation">,</span> apparmor_secid_to_secctx<span class="token punctuation">)</span><span class="token punctuation">,</span>
	<span class="token function">LSM_HOOK_INIT</span><span class="token punctuation">(</span>secctx_to_secid<span class="token punctuation">,</span> apparmor_secctx_to_secid<span class="token punctuation">)</span><span class="token punctuation">,</span>
	<span class="token function">LSM_HOOK_INIT</span><span class="token punctuation">(</span>release_secctx<span class="token punctuation">,</span> apparmor_release_secctx<span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre></div>
<p><code class="language-text">security_add_hooks()</code> 함수는 <a href="https://github.com/torvalds/linux/blob/v4.19/security/security.c"><code class="language-text">security/security.c</code></a>에 구현되어 있다.</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token keyword">void</span> __init <span class="token function">security_add_hooks</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">security_hook_list</span> <span class="token operator">*</span>hooks<span class="token punctuation">,</span> <span class="token keyword">int</span> count<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span>lsm<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">int</span> i<span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> count<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        hooks<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>lsm <span class="token operator">=</span> lsm<span class="token punctuation">;</span>
        <span class="token function">hlist_add_tail_rcu</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>hooks<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>list<span class="token punctuation">,</span> hooks<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>head<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">slab_is_available</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">lsm_append</span><span class="token punctuation">(</span>lsm<span class="token punctuation">,</span> <span class="token operator">&amp;</span>lsm_names<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
            <span class="token function">panic</span><span class="token punctuation">(</span><span class="token string">"%s - Cannot get early memory.\n"</span><span class="token punctuation">,</span> <span class="token constant">__func__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>   </code></pre></div>
<p>이 함수에서 <code class="language-text">hooks</code>는 추가하고자 하는 hook, <code class="language-text">count</code>는 추가하고자 하는 hook의 개수, <code class="language-text">lsm</code>은 Security Module의 이름이 인자로 전달된다.</p>
<p><code class="language-text">struct security_hooks_list</code> 구조체는 <code class="language-text">/include/linux/lsm_hooks.h</code>에 다음과 같이 정의되어 있다:</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token keyword">union</span> security_list_options <span class="token punctuation">{</span>
	<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name function">LSM_HOOK</span><span class="token expression"><span class="token punctuation">(</span>RET<span class="token punctuation">,</span> DEFAULT<span class="token punctuation">,</span> NAME<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span> <span class="token function">RET</span> <span class="token punctuation">(</span><span class="token operator">*</span>NAME<span class="token punctuation">)</span><span class="token punctuation">(</span>__VA_ARGS__<span class="token punctuation">)</span><span class="token punctuation">;</span></span></span>
	<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"lsm_hook_defs.h"</span></span>
	<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">undef</span> <span class="token expression">LSM_HOOK</span></span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">struct</span> <span class="token class-name">security_hook_heads</span> <span class="token punctuation">{</span>
	<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name function">LSM_HOOK</span><span class="token expression"><span class="token punctuation">(</span>RET<span class="token punctuation">,</span> DEFAULT<span class="token punctuation">,</span> NAME<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span> <span class="token keyword">struct</span> <span class="token class-name">hlist_head</span> NAME<span class="token punctuation">;</span></span></span>
	<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"lsm_hook_defs.h"</span></span>
	<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">undef</span> <span class="token expression">LSM_HOOK</span></span>
<span class="token punctuation">}</span> __randomize_layout<span class="token punctuation">;</span>

<span class="token comment">/*
 * Security module hook list structure
 * For use with generic list macros for common operations.
 */</span>
<span class="token keyword">struct</span> <span class="token class-name">security_hook_list</span> <span class="token punctuation">{</span>
    <span class="token keyword">struct</span> <span class="token class-name">hlist_node</span>           list<span class="token punctuation">;</span>
    <span class="token keyword">struct</span> <span class="token class-name">hlist_head</span>           <span class="token operator">*</span>head<span class="token punctuation">;</span>
    <span class="token keyword">union</span> security_list_options hook<span class="token punctuation">;</span>
    <span class="token keyword">char</span>                        <span class="token operator">*</span>lsm<span class="token punctuation">;</span>
<span class="token punctuation">}</span> __randomize_layout<span class="token punctuation">;</span></code></pre></div>
<p>이 구조체에서 <code class="language-text">char *lsm</code> 은 <code class="language-text">apparmor</code>와 같은 Security Module이 되고, <code class="language-text">union security_list_options hook</code>은 Security Module의 hook function이 된다.
즉, 각 Security Module들은 정해진 순서에 따라 초기화를 진행하며, 이 때 <code class="language-text">security_add_hooks()</code> 함수를 통해 Security Module에 등록된 LSM hooks의 Hook Head에 Securiy Module의 LSM Hook function을 추가함으로써, 해당 Hook이 트리거되었을 때 Security Module의 Hook function이 차례로 실행될 수 있도록 한다.</p>
<p>코드를 기반으로 LSM Module의 구조를 정리하면 다음과 같다.</p>
<p><img src="LSM-1.png" alt="LSM-1.png"></p>
<p><code class="language-text">file_open</code> Hook Head에 Capability Module과 AppArmor Module 순으로 연결된 모습이다.
먼저 LSM에 올라온 Security Module의 Hook Function이 먼저 수행되고, 중간 Hook Funtion의 결과가 No라면 그 즉시 중단한다.
위의 경우에는, <code class="language-text">file_open</code> hook이 커널 코드 실행 중 발생하면, 가장 먼저 Capability의 <code class="language-text">file_open</code> Hook Function이 실행된다.
Capability의 <code class="language-text">file_open</code> Hook Funtion의 결과가 Allow라면, 그 다음 AppArmor의 <code class="language-text">file_open</code> Hook Function이 실행되지만
Capaviltiy의 경과가 Deny라면 다음 AppArmor의 Hook Function을 수행하지 않고 바로 LSM을 빠져나온다.</p>
<p>LSM Hook Function은 대부분 정수값을 반환하며, 0을 반환할 시에 해당 동작을 Allow함을 의미한다.
<code class="language-text">ENOMEM</code>은 사용 가능한 메모리가 부족하여 Deny됨을 의미하며, <code class="language-text">EACCESS</code>는 보안 정책에 의해 Access가 Deny됨을 의미, <code class="language-text">EPERM</code>은 해당 동작을 수행하기 위한 권한이 부족하여 Deny됨을 의미한다.</p>
<h3 id="lsm-hooks-with-system-call" style="position:relative;"><a href="#lsm-hooks-with-system-call" aria-label="lsm hooks with system call permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>LSM Hooks with System call</h3>
<p>사용자가 커널 함수를 사용하는 일반적인 방법은 시스템콜을 사용하는 것이다.
<code class="language-text">fopen()</code>과 같은 glibc API 라이브러리 함수는 내부에서 시스템콜을 호출하는데,</p>
<p>앞서 언급했던 <code class="language-text">file_open</code> LSM Hook 과 관련된 대표적인 시스템콜이 <code class="language-text">open()</code>시스템콜이다.
그렇다면 <code class="language-text">open</code> 시스템콜이 동작할 때 LSM Hook이 어떻게 동작하는지를 살펴보면 다음과 같다.</p>
<p><code class="language-text">file_open</code> LSM Hook은 <code class="language-text">/security/security.c</code> 파일에 다음과 같이 정의되어 있다.</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token keyword">int</span> <span class="token function">security_file_open</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">file</span> <span class="token operator">*</span>file<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token keyword">int</span> ret<span class="token punctuation">;</span>

	ret <span class="token operator">=</span> <span class="token function">call_int_hook</span><span class="token punctuation">(</span>file_open<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> file<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>ret<span class="token punctuation">)</span>
		<span class="token keyword">return</span> ret<span class="token punctuation">;</span>

	<span class="token keyword">return</span> <span class="token function">fsnotify_perm</span><span class="token punctuation">(</span>file<span class="token punctuation">,</span> MAY_OPEN<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>즉, <code class="language-text">file_open</code> Hook이 호출되는 함수는 <code class="language-text">security_file_open()</code>이며, 해당 함수가 사용된 함수는 <code class="language-text">/fs/open.c</code>에 위치한 <code class="language-text">do_dentry_open()</code> 함수이다.</p>
<p><code class="language-text">open</code> 시스템콜은 커널 내부에서 <code class="language-text">do_sys_open()</code> -> <code class="language-text">do_sys_openat2()</code> -> <code class="language-text">do_filp_open()</code> -> <code class="language-text">path_openat()</code> -> <code class="language-text">do_open()</code> -> <code class="language-text">vfs_open()</code> -> <code class="language-text">do_dentry_open()</code> -> <code class="language-text">open</code> 시스템콜 순으로 호출된다.</p>
<p><code class="language-text">security_file_open()</code> 함수가 있는 <code class="language-text">do_dentry_open()</code> 함수를 살펴보면 다음과 같다.
(함수가 길기 때문에 중간에 관련 없는 내용은 생략했다.)</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token function">do_dentry_open</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">file</span> <span class="token operator">*</span>f<span class="token punctuation">,</span>
			  <span class="token keyword">struct</span> <span class="token class-name">inode</span> <span class="token operator">*</span>inode<span class="token punctuation">,</span>
			  <span class="token keyword">int</span> <span class="token punctuation">(</span><span class="token operator">*</span>open<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">inode</span> <span class="token operator">*</span><span class="token punctuation">,</span> <span class="token keyword">struct</span> <span class="token class-name">file</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">(</span>생략<span class="token punctuation">)</span>

	error <span class="token operator">=</span> <span class="token function">security_file_open</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// file_open LSM HOOK 호출!</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span>
		<span class="token keyword">goto</span> cleanup_all<span class="token punctuation">;</span>

	<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">(</span>생략<span class="token punctuation">)</span>

	f<span class="token operator">-></span>f_mode <span class="token operator">|=</span> FMODE_LSEEK <span class="token operator">|</span> FMODE_PREAD <span class="token operator">|</span> FMODE_PWRITE<span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>open<span class="token punctuation">)</span>
		open <span class="token operator">=</span> f<span class="token operator">-></span>f_op<span class="token operator">-></span>open<span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>open<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		error <span class="token operator">=</span> <span class="token function">open</span><span class="token punctuation">(</span>inode<span class="token punctuation">,</span> f<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// open 시스템콜 호출!</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span>
			<span class="token keyword">goto</span> cleanup_all<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">(</span>생략<span class="token punctuation">)</span>
<span class="token punctuation">}</span></code></pre></div>
<p>중간에 <code class="language-text">security_file_open()</code> 함수를 확인할 수 있다.</p>
<p>즉, 시스템콜 함수 내부에 LSM hook이 위치하는 것이다.</p>
<p>따라서 User-space에서 <code class="language-text">open()</code> 시스템콜을 호출할 경우 다음과 같이 동작하게 된다.
아래 다이어그램은 LSM 프레임워크에 <code class="language-text">security_file_open()</code> hook에 3개의 Security Module을 등록한 <code class="language-text">open()</code> 시스템콜에 대한 대략적인 호출 흐름을 보여준다.</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; "
    >
      <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 71.11111111111111%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAOABQDASIAAhEBAxEB/8QAFwAAAwEAAAAAAAAAAAAAAAAAAAIDBf/EABQBAQAAAAAAAAAAAAAAAAAAAAD/2gAMAwEAAhADEAAAAdak6DjB/8QAGhAAAgIDAAAAAAAAAAAAAAAAASEAEgIQMf/aAAgBAQABBQIo2bmfaa//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/AT//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/AT//xAAWEAADAAAAAAAAAAAAAAAAAAAQIDH/2gAIAQEABj8CFT//xAAbEAADAAIDAAAAAAAAAAAAAAAAAREQQSFh8f/aAAgBAQABPyG+CsbqITxE310Q3bj/2gAMAwEAAgADAAAAELPP/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPxA//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPxA//8QAHRABAQABBAMAAAAAAAAAAAAAAREAECExUUHB0f/aAAgBAQABPxBQihLt8woLO5m++jDSrhfK4gvgdaf/2Q=='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="LSM-2.jpeg"
        title="LSM-2.jpeg"
        src="/static/d5b19d5c3e662db3a61025d1c1477a87/80e3c/LSM-2.jpg"
        srcset="/static/d5b19d5c3e662db3a61025d1c1477a87/4ec73/LSM-2.jpg 180w,
/static/d5b19d5c3e662db3a61025d1c1477a87/158ba/LSM-2.jpg 360w,
/static/d5b19d5c3e662db3a61025d1c1477a87/80e3c/LSM-2.jpg 720w,
/static/d5b19d5c3e662db3a61025d1c1477a87/72e01/LSM-2.jpg 1024w"
        sizes="(max-width: 720px) 100vw, 720px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
        decoding="async"
      />
    </span></p>
<ol>
<li>User-spcae의 프로세스는 파일 경로에 대한 <code class="language-text">open()</code> 시스템콜을 호출한다.</li>
<li>시스템콜이 Kenrel-space로 전달되고 파일 경로 문자열을 사용하여 커널 파일 object를 얻음. 만약 파일 path 인자가 올바르지 않을 경우, 오류로 리턴된다.</li>
<li>DAC 파일 permission이 확인됨. 현재 사용자에게 요청한 파일을 열 수 있는 권한이 있는지 Check. 만약 permission이 없을 경우 시스템콜은 종료되고 사용자에게 error가 반환됨</li>
<li>DAC이 충족할 경우, LSM 프레임워크가 활성화된 LSM Moulde에 대한 각 <code class="language-text">file_open</code> hook function을 호출한다. 만약, 한 개의 LSM hook function이라도 error를 반환할 경우 시스템콜이 종료되고 사용자에게 error가 반환된다.</li>
<li>모든 Security Check가 통과할 경우, 프로세스를 위한 파일이 열리고, 새로운 fd(file descriptor)가 User-space의 프로세스에게 반환된다.</li>
</ol>
<p>즉, LSM Hook을 통한 MAC 이전에 위와 같이 Error checks, DAC checks가 먼저 수행되고 LSM Hook을 이용한 MAC checks는 가장 나중에 수행된다.</p>
<h2 id="3-security-module" style="position:relative;"><a href="#3-security-module" aria-label="3 security module permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>3. Security Module</h2>
<p>Linux LSM 프레임워크 위에서 동작하는 MAC(Mandatory Access Control) 기반 Security Module에는 AppArmor, SELinux, Smack, Tomoyo 등이 있다.</p>
<p>현재 리눅스 커널(v6.2)에서 지원하는 Security Module은 <code class="language-text">/security/Kconfig</code>에 정의되어 있다.</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c">config LSM
	string <span class="token string">"Ordered list of enabled LSMs"</span>
	<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">(</span>생략<span class="token punctuation">)</span>
	<span class="token keyword">default</span> <span class="token string">"landlock,lockdown,yama,loadpin,safesetid,integrity,selinux,smack,tomoyo,apparmor,bpf"</span></code></pre></div>
<p>이외에 LSM Capabilities Module이 존재하며 항상 LSM 프레임워크에 포함되기 때문에, LSM 프레임워크에 등록될 때 다른 Security Module보다 항상 우선순위를 가진다.</p>
<p>LSM Module은 크게 Major Module과 Minor Module, 두 가지 유형으로 구분된다.
Major Security Module은 User-space로부터 보안 정책을 전달받아 MAC 기능을 제공하는 LSM 모듈들이다.</p>
<p>Major Security Module은 여러 커널 객체 내부에 존재하는 security context 포인터 및 security identifier에 대한 엑세스 권한에 대한 독점을 요구하기 때문에 하나의 시스템에는 하나의 Major Security Module만 사용할 수 있다.
이러한 Major Security Module에 해당하는 LSM Module로는 SELinux, SMACK, AppARmor, TOMOYO가 있다.</p>
<p>반면 Minor Security Module은 특정 보안 기능(e.g., ptrace 기능 제한)을 구현하기 위한 목적으로 개발된 모듈로써, 일반적으로 보다 적은 보안 기능을 제공하며 필요한 context도 비교적 적다.
또한, User-space로부터 보안 정책을 전달받아 동작하는 Major Security Module과는 달리, 보안 정책이 직접 하드 코딩되어있다.
따라서 enable/disable 정도의 간단한 옵션을 지닌다.
이러한 Minor Security Module에 해당하는 LSM Module로는 Yama, LoadPin, SetSafeID, Lockdown, Landlock 등이 있다.</p>
<p>LSM은 최대 하나의 Major 모듈과 다수의 Minor 모듈을 Stacking할 수 있다.
현재 활성화된 LSM Module은 <code class="language-text">/sys/kernel/security/lsm</code>에서 확인할 수 있으며, 여기에는 항상 Capabilities Module이 포함된다.
예를 들어, Capability 모듈 이외에 Yama와 같은 여러 ‘Minor’ Module이 위치하며 AppArmor와 같은 하나의 ‘Major’ Module이 구성될 수 있다.</p>
<p>그러나, LSM 프레임워크는 “Major”와 “Minor” 사이의 구분을 없애기 위한 수정을 계속하고 있으며, 사용자는 <code class="language-text">LSM_FLAG_EXCLUSIVE</code>가 설정된 Security Module 하나만을 가진다면 원하는 만큼 Security Module을 사용해서 LSM을 구성할 수 있다.
AppArmor는 곧 <code class="language-text">LSM_FLAG_EXCLUSIVE</code> 구분을 잃게될 것이며, 다른 모듈들도 그 뒤를 따를 것이다.</p>
<h3 id="31-selinux---security-enhanced-linux" style="position:relative;"><a href="#31-selinux---security-enhanced-linux" aria-label="31 selinux   security enhanced linux permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>3.1. SELinux - Security Enhanced Linux</h3>
<p>리눅스 v2.6에서 처음 merge된 SELInux는 RedHat 기반 리눅스 배포반의 default MAC 구현체이다.
SELinux는 강력하지만, 또한 복잡하기로도 유명하다.</p>
<p>모든 프로세스 및 시스템 리소스에는 <code class="language-text">SELinux Context</code>라는 특수한 보안 레이블이 존재한다.
SELinux 레이블이라도고도 하는 <code class="language-text">SELInux Context</code>는 시스템 레벨의 세부 정보를 추상화하고 object의 보안 속성에 중점을 둔 식별자이다.
이러한 <code class="language-text">SELinux Context</code>는 extended attributes(<code class="language-text">xattrs</code>)를 사용하여 파일 시스템 object에 저장된다.</p>
<p>SELinux 정책은 프로세스가 다양한 시스템 리소스와 상호 작용할 수 있는 방법을 정의하는 규칙을 정의하기 위해 이러한 Context를 사용한다.
default로는 deny로 동작하며, 보안 정책이 명시적으로 액세스 권한을 부여하지 않는 한 상호 작용이 거부된다.</p>
<p>예를 들어, <code class="language-text">ls -Z</code>를 사용하여 <code class="language-text">/bin/bash</code>의 <code class="language-text">SELinux Context</code>를 확인할 수 있다:</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">$ <span class="token function">ls</span> -Z /bin/bash
-rwxr-xr-x. root root system_u:object_r:shell_exec_t:s0 /bin/bash</code></pre></div>
<p>위에서는 <code class="language-text">SELinux Cotext</code>가 <code class="language-text">system_u:object_r:shell_exec_t:s0</code>이다.
네 개의 field는 콜론으로 구분되며 각각 <code class="language-text">user:role:type:level</code>을 의미한다.</p>
<p>즉, SELinux는 ”<code class="language-text">subject</code>기 <code class="language-text">object</code>에게 <code class="language-text">action</code>을 할 수 있는가?”라는 질문에 답할 수 있도록 정책을 설정한다.
예를 들면, ”<code class="language-text">web server</code>가 <code class="language-text">user의 home dicectories에 있는 file</code>에 <code class="language-text">access</code>할 수 있는가?”에 대한 MAC permission을 구현한다.</p>
<p><code class="language-text">SELinux Context</code>의 여러 field 중에서도 SELinux <code class="language-text">type</code>은 SELinux 정책에서 가장 중요한 역할을 한다.
SELinux <code class="language-text">type</code>은 일반적으로 <code class="language-text">_t</code>로 끝나며, 다양한 <code class="language-text">type</code>이 있고 이를 subject에게 라벨링할 수 있다.
예를 들어, 웹 서버의 <code class="language-text">type</code>은 <code class="language-text">httpd_t</code>이며, <code class="language-text">/var/www/html/</code> 위치에 있는 파일 및 디렉터리듸 <code class="language-text">type</code>은 <code class="language-text">httpd_sys_content_t</code>이다.
또한, <code class="language-text">/tmp</code> 및 <code class="language-text">/var/tmp</code>에 있는 파일 및 디렉터리의 <code class="language-text">type</code>은 <code class="language-text">tmp_t</code>이며, 웹 서버 포트의 <code class="language-text">type</code>은 <code class="language-text">http_port_t</code>이다.</p>
<p>SELinux에서 보안 정책을 설정하는 가장 일반적인 방법은 SELinux <code class="language-text">subject</code>(위의 예에서 <code class="language-text">user</code>)가 특정한 <code class="language-text">type</code>으로 라벨링된 <code class="language-text">object</code>에게 수행할 수 있는 <code class="language-text">action</code>을 지정하는 것이다.
위의 예로 다시 살펴보면, 기본 DAC permission(위의 예에서 <code class="language-text">-rwxr-xr-x</code>)은 시스템의 모든 사용자가 <code class="language-text">bash</code>를 읽고 실행할 수 있음을 나타낸다.
하지만, SELinux를 사용하면 보안 관리자가 <code class="language-text">shell_exec_t</code> type의 <code class="language-text">/bin/bash</code> 파일을 실행하거나 읽을 수 있는 <code class="language-text">subject</code>를 추가로 지정할 수 있다.</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; "
    >
      <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 39.44444444444444%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAIAAAB2/0i6AAAACXBIWXMAAAsTAAALEwEAmpwYAAABEUlEQVQY022PcW+DIBDF+f7frNmSdd1itKZVlLuRQKtR7KRwsIir25L9wh/vwb3wjpkHY2IVzrn4C+/99jQMw6qNMaxpmrZtq6p6fnoqy7Jt27quh2EgopAOEY3jWNe1ECLP891ut441TcMuK1pzgUrpJPU8z95755zzC9ZarfX1elVKcYGXi15DbOumbp7Cw4RF3TifTqfNxhgpRPXptwi7JwKRHK1Lv1lrA1GMce77ueuWLNE6dndeGkve2+QYAAghsiw7vL2/Hg6ccwDous45l/ZdYn3fCyEQMcuyl/2+KApEBAD2kSgTx+MRABDRGPPdNhWepgkApJTV+VzkOedcSomILCTiz7J/7L/3ROQSX/gzxVIR3A0/AAAAAElFTkSuQmCC'); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="LSM-3.png"
        title="LSM-3.png"
        src="/static/f7b4d4a7ee54ec0153a3422060470895/37523/LSM-3.png"
        srcset="/static/f7b4d4a7ee54ec0153a3422060470895/e9ff0/LSM-3.png 180w,
/static/f7b4d4a7ee54ec0153a3422060470895/f21e7/LSM-3.png 360w,
/static/f7b4d4a7ee54ec0153a3422060470895/37523/LSM-3.png 720w,
/static/f7b4d4a7ee54ec0153a3422060470895/302a4/LSM-3.png 1080w,
/static/f7b4d4a7ee54ec0153a3422060470895/07a9c/LSM-3.png 1440w,
/static/f7b4d4a7ee54ec0153a3422060470895/891d5/LSM-3.png 1520w"
        sizes="(max-width: 720px) 100vw, 720px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
        decoding="async"
      />
    </span></p>
<p>위의 그림에서 SELinux는 <code class="language-text">httpd_t</code> type으로 실행되는 Apache 프로세스가 <code class="language-text">/var/www/html/</code> 디렉터리에 액세스하는 것을 allow하지만, 동일한 프로세스가 <code class="language-text">/data/mysql</code> 디렉터리에 액세스하는 것은 deny된다.
<code class="language-text">mysqld_db_t</code> type의 Context에 대한 allow 규칙을 가지고 있지 않기 때문이다.</p>
<p>반면에, <code class="language-text">mysqld_t</code>로 실행되는 MariaDB 프로세스는 <code class="language-text">/data/mysql</code> 디렉터리에 액세스할 수 있으며, SELinux는 <code class="language-text">mysql_t</code> type의 프로세스가 <code class="language-text">httpd_sys_content_t</code>로 레이블된 <code class="language-text">/var/www/html/</code> 디렉터리에 액세스하는 것을 deny한다.</p>
<h4 id="selinux의-이점" style="position:relative;"><a href="#selinux%EC%9D%98-%EC%9D%B4%EC%A0%90" aria-label="selinux의 이점 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>SELinux의 이점</h4>
<ul>
<li>모든 프로세스와 파일에 <code class="language-text">type</code>으로 레이블이 지정된다. SELinux의 policy rule은 ‘프로세스-파일’ 간의 상호 작용 방식과 ‘프로세스-프로세스’ 간의 상호 작용 방식을 정의한다. 서로 간의 액세스는 SELinux에 정의된 policy rule이 있는 경우에만 allow된다.</li>
<li>세분화된 액세스 제어가 가능한다. 기존에 리눅스가 DAC으로 제공하는 사용자 및 그룹 ID를 기반으로 하는 Permission 제어를 넘어서, user, type, role, level과 같이 확장된 permission을 제어할 수 있다.</li>
<li>SELinux policy는 관리자가 정의하며, 시스템 전체에 적용된다.</li>
<li>privilege escalation attack(권한 상승 공격)에 대해 더 나은 완화 기능을 제공한다. 만약 프로세스가 손상된 경우, 공격자는 해당 프로세스의 일반적인 기능과 SELinux에 의해 프로세스가 액세스할 수 있도록 allow된 파일에만 액세스 가능하다. 예를 들어, Apache HTTP Server가 손상된 경우, 공격자는 특정 SELinux policy에 의해 사용자의 home 디렉터리에 위치한 파일들에 접근할 수 없다.</li>
<li>SELinux는 데이터의 Confidentiality(기밀성)과 Integrity(무결성)을 강화하며, 신뢰할 수 없는 입력으로부터 프로세스를 보호하는 데에도 사용될 수 있다.</li>
</ul>
<h4 id="selinux의-한계" style="position:relative;"><a href="#selinux%EC%9D%98-%ED%95%9C%EA%B3%84" aria-label="selinux의 한계 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>SELinux의 한계</h4>
<ul>
<li>Anti-virus 소프트웨어가 아니다.</li>
<li>암호, 방화벽, 기타 보안 시스템을 대체할 수 없다.</li>
<li>All-in-One 보안 솔루션이 아니다.</li>
</ul>
<p>SELinux는 기존 보안 솔루션을 완전히 대체하는 솔루션이 아니라, 기존 보안 솔루션을 강화하도록 설계되었다.
따라서 SELinux를 시스템에 적용하더라도 기존의 보안 관행(e.g., 소프트웨어 최신 상태로 업데이트, 추측하기 어려운 암호 사용, 방화벽 사용)을 계속 따라야한다.</p>
<h3 id="32-apparmor" style="position:relative;"><a href="#32-apparmor" aria-label="32 apparmor permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>3.2. AppArmor</h3>
<p><a href="https://apparmor.net">AppArmor</a>는 리눅스 커널 v2.6.36 릴리스에서 커널에 병합된 또 다른 MAC 구현체이다.
SELinux와 차이점은 AppAmor의 경우 Debian 기반 시스템의 기본 MAC 구현체라는 것이다.</p>
<p>이 외에도 AppArmor와 SELinux의 또 다른 가장 큰 차이점은 attribute 기반이 아닌 path 기반을 작동한다는 것이다.
이를 통해 AppAmor는 SELinux의 복잡성을 다소 낮췄다고 볼 수 있다.</p>
<p>이러한 path 기반 구현은 Security Context를 저장하는 데 따로 확장 attribute가 필요하지 않기 때문에 모든 파일 시스템의 파일을 보호할 수 있다.
실제 파일이나 디렉터리에 따로 레이블을 지정할 필요 없이 policy rule에 path를 저장할 수 있으므로 아직 존재하지 않는 파일에 대해서도 규칙을 지정할 수 있다.</p>
<p>하지만, path 기반 구현은 Hard link 등과 같이 실제 파일을 참조하는 여러 경로가 있을 수 있다는 점이다.
즉, 파일에 대한 policy rule(Profile)은 해당 파일에 도달하는 데까지 사용된 경로에 따라 다르게 적용될 수 있으며, 이것이 보안 허점을 만들어 낼 수 있다.</p>
<p>AppArmor는 Enforcement, Compain 2가지 모드로 동작한다.</p>
<ul>
<li>Enforcement 모드: 프로그램의 허용되지 않은 동작을 deny하고 log에 이를 남긴다. 실제 프로그램을 운영하면서 동작을 제한할 때 이용하는 모드이다.</li>
<li>Complain 모드: 프로그램의 허용되지 않은 동작을 deny하지는 않고 log만 남긴다. 특정 프로그램의 AppArmor Profile을 작성할 때 이용하는 모드이다. 기록된 log를 통해서 AppArmor Profile 작성 시 어떤 동작을 allow해야 하는지에 대해 참고할 수 있다.</li>
</ul>
<p><code class="language-text">aa-status</code> 명령어를 이용하여 AppArmor의 상태를 조회할 수 있다.
해당 명령어는 AppArmor가 이용하는 Profile과 Profile이 적용된 프로세스를 출력한다.
AppArmor의 정보는 <code class="language-text">/sys/kernel/security/apparmor</code> 폴더 안에 위치하고 있으며, 해당 명령어는 이 폴더 안의 내용을 정리해서 보여주는 역할이다.</p>
<p><code class="language-text">/sys/kernel/securiy/apparmor</code> 폴더 안에는 다음과 같은 파일들이 위치하고 있다:</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">root@bastion:/home<span class="token comment"># ll /sys/kernel/security/apparmor/</span>
total <span class="token number">0</span>
drwxr-xr-x  <span class="token number">3</span> root root    <span class="token number">0</span>  <span class="token number">8</span>월  <span class="token number">4</span> <span class="token number">11</span>:25 ./
drwxr-xr-x  <span class="token number">4</span> root root    <span class="token number">0</span>  <span class="token number">8</span>월  <span class="token number">4</span> <span class="token number">11</span>:25 <span class="token punctuation">..</span>/
-rw-rw-rw-  <span class="token number">1</span> root root    <span class="token number">0</span>  <span class="token number">8</span>월  <span class="token number">4</span> <span class="token number">11</span>:25 .access
drwxr-xr-x <span class="token number">15</span> root root    <span class="token number">0</span>  <span class="token number">8</span>월  <span class="token number">4</span> <span class="token number">11</span>:25 features/
-rw-rw-rw-  <span class="token number">1</span> root root    <span class="token number">0</span>  <span class="token number">8</span>월  <span class="token number">4</span> <span class="token number">11</span>:25 .load
-r--r--r--  <span class="token number">1</span> root root    <span class="token number">0</span>  <span class="token number">8</span>월  <span class="token number">4</span> <span class="token number">11</span>:25 .ns_level
-r--r--r--  <span class="token number">1</span> root root    <span class="token number">0</span>  <span class="token number">8</span>월  <span class="token number">4</span> <span class="token number">11</span>:25 .ns_name
-r--r--r--  <span class="token number">1</span> root root    <span class="token number">0</span>  <span class="token number">8</span>월  <span class="token number">4</span> <span class="token number">11</span>:25 .ns_stacked
crw-rw-rw-  <span class="token number">1</span> root root <span class="token number">1</span>, <span class="token number">3</span>  <span class="token number">8</span>월  <span class="token number">4</span> <span class="token number">11</span>:25 .null
lr--r--r--  <span class="token number">1</span> root root    <span class="token number">0</span>  <span class="token number">8</span>월  <span class="token number">4</span> <span class="token number">11</span>:25 policy -<span class="token operator">></span> <span class="token string">'apparmorfs:[14707]'</span>
-r--r--r--  <span class="token number">1</span> root root    <span class="token number">0</span>  <span class="token number">8</span>월  <span class="token number">4</span> <span class="token number">11</span>:25 profiles
-rw-rw-rw-  <span class="token number">1</span> root root    <span class="token number">0</span>  <span class="token number">8</span>월  <span class="token number">4</span> <span class="token number">11</span>:25 .remove
-rw-rw-rw-  <span class="token number">1</span> root root    <span class="token number">0</span>  <span class="token number">8</span>월  <span class="token number">4</span> <span class="token number">11</span>:25 .replace
-r--r--r--  <span class="token number">1</span> root root    <span class="token number">0</span>  <span class="token number">8</span>월  <span class="token number">4</span> <span class="token number">11</span>:25 revision
-r--r--r--  <span class="token number">1</span> root root    <span class="token number">0</span>  <span class="token number">8</span>월  <span class="token number">4</span> <span class="token number">11</span>:25 .stacked</code></pre></div>
<p><code class="language-text">aa-status</code> 명령어의 출력 결과는 다음과 같다:</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">root@bastion:/home<span class="token comment"># aa-status</span>
apparmor module is loaded.
<span class="token number">63</span> profiles are loaded.
<span class="token number">60</span> profiles are <span class="token keyword">in</span> enforce mode.
   /snap/snapd/16010/usr/lib/snapd/snap-confine
   /snap/snapd/16010/usr/lib/snapd/snap-confine//mount-namespace-capture-helper
   /snap/snapd/16292/usr/lib/snapd/snap-confine
   /snap/snapd/16292/usr/lib/snapd/snap-confine//mount-namespace-capture-helper
   /snap/snapd/16778/usr/lib/snapd/snap-confine
   /snap/snapd/16778/usr/lib/snapd/snap-confine//mount-namespace-capture-helper
   /snap/snapd/17029/usr/lib/snapd/snap-confine
   /snap/snapd/17029/usr/lib/snapd/snap-confine//mount-namespace-capture-helper
   /snap/snapd/17336/usr/lib/snapd/snap-confine
   /snap/snapd/17336/usr/lib/snapd/snap-confine//mount-namespace-capture-helper
   /usr/bin/evince
   /usr/bin/evince-previewer
   /usr/bin/evince-previewer//sanitized_helper
   /usr/bin/evince-thumbnailer
   /usr/bin/evince//sanitized_helper
   /usr/bin/man
   /usr/lib/NetworkManager/nm-dhcp-client.action
   /usr/lib/NetworkManager/nm-dhcp-helper
   /usr/lib/connman/scripts/dhclient-script
   /usr/lib/cups/backend/cups-pdf
   /usr/lib/snapd/snap-confine
   /usr/lib/snapd/snap-confine//mount-namespace-capture-helper
   /usr/sbin/cups-browsed
   /usr/sbin/cupsd
   /usr/sbin/cupsd//third_party
   /usr/sbin/ntpd
   /usr/sbin/tcpdump
   /<span class="token punctuation">{</span>,usr/<span class="token punctuation">}</span>sbin/dhclient
   docker-default
   ippusbxd
   libvirt-1aba34b6-ccf2-49d3-9a32-e7dee5c2f701
   libvirt-1cd08b80-0ed0-428f-84ba-ac68b01b37f5
   libvirt-2c02a164-4e6b-4447-873d-8f9d9c257d3b
   libvirt-612f8ff8-9f42-4166-94f4-4ea329845093
   libvirt-61a08af2-1e8b-4d1e-bb78-14f69e2d0d94
   libvirt-6345c508-715e-4291-a178-bce70d2e442c
   libvirt-6d586ec1-444e-417f-81f1-ab3204e55edd
   libvirt-6ff38ba8-b31e-4bdf-b0f8-6713fcd606a1
   libvirt-7198fda1-825d-4eaf-b993-ef08304e765c
   libvirt-970b6862-1c8a-46b2-bed4-467699ca9fd3
   libvirt-98179a8a-6ee5-4a0c-bcb3-20a869d51934
   libvirt-9b850c34-dec9-4f83-b7e6-f3667556aa1a
   libvirt-b6b75415-de22-4846-a56b-45e0ace7a6f6
   libvirt-ccf5b79c-0ba1-4067-92c4-475d85c3e91c
   libvirt-e2416988-4191-4209-9b38-dfaabf2015d1
   libvirt-ed563373-5625-4e84-8bbb-4fa569418c66
   libvirt-ef0a4fc5-8a0a-4f2b-8a06-78348397ef3b
   libvirtd
   libvirtd//qemu_bridge_helper
   lsb_release
   man_filter
   man_groff
   nvidia_modprobe
   nvidia_modprobe//kmod
   snap-update-ns.snap-store
   snap.snap-store.hook.configure
   snap.snap-store.snap-store
   snap.snap-store.ubuntu-software
   snap.snap-store.ubuntu-software-local-file
   virt-aa-helper
<span class="token number">3</span> profiles are <span class="token keyword">in</span> complain mode.
   /usr/lib/ibus/ibus-engine-hangul
   /usr/lib/ibus/ibus-setup-hangul
   /usr/lib/ibus/ibus-setup-hangul//python_profile
<span class="token number">21</span> processes have profiles defined.
<span class="token number">21</span> processes are <span class="token keyword">in</span> enforce mode.
   /usr/sbin/cups-browsed <span class="token punctuation">(</span><span class="token number">3637361</span><span class="token punctuation">)</span> 
   /usr/sbin/cupsd <span class="token punctuation">(</span><span class="token number">3637359</span><span class="token punctuation">)</span> 
   /usr/sbin/ntpd <span class="token punctuation">(</span><span class="token number">31958</span><span class="token punctuation">)</span> 
   /usr/bin/qemu-system-x86_64 <span class="token punctuation">(</span><span class="token number">3899868</span><span class="token punctuation">)</span> libvirt-1aba34b6-ccf2-49d3-9a32-e7dee5c2f701
   /usr/bin/qemu-system-x86_64 <span class="token punctuation">(</span><span class="token number">3899509</span><span class="token punctuation">)</span> libvirt-1cd08b80-0ed0-428f-84ba-ac68b01b37f5
   /usr/bin/qemu-system-x86_64 <span class="token punctuation">(</span><span class="token number">2185176</span><span class="token punctuation">)</span> libvirt-2c02a164-4e6b-4447-873d-8f9d9c257d3b
   /usr/bin/qemu-system-x86_64 <span class="token punctuation">(</span><span class="token number">383493</span><span class="token punctuation">)</span> libvirt-612f8ff8-9f42-4166-94f4-4ea329845093
   /usr/bin/qemu-system-x86_64 <span class="token punctuation">(</span><span class="token number">2185167</span><span class="token punctuation">)</span> libvirt-61a08af2-1e8b-4d1e-bb78-14f69e2d0d94
   /usr/bin/qemu-system-x86_64 <span class="token punctuation">(</span><span class="token number">1297476</span><span class="token punctuation">)</span> libvirt-6345c508-715e-4291-a178-bce70d2e442c
   /usr/bin/qemu-system-x86_64 <span class="token punctuation">(</span><span class="token number">365800</span><span class="token punctuation">)</span> libvirt-6d586ec1-444e-417f-81f1-ab3204e55edd
   /usr/bin/qemu-system-x86_64 <span class="token punctuation">(</span><span class="token number">2103334</span><span class="token punctuation">)</span> libvirt-6ff38ba8-b31e-4bdf-b0f8-6713fcd606a1
   /usr/bin/qemu-system-x86_64 <span class="token punctuation">(</span><span class="token number">3899196</span><span class="token punctuation">)</span> libvirt-7198fda1-825d-4eaf-b993-ef08304e765c
   /usr/bin/qemu-system-x86_64 <span class="token punctuation">(</span><span class="token number">385028</span><span class="token punctuation">)</span> libvirt-970b6862-1c8a-46b2-bed4-467699ca9fd3
   /usr/bin/qemu-system-x86_64 <span class="token punctuation">(</span><span class="token number">3899363</span><span class="token punctuation">)</span> libvirt-98179a8a-6ee5-4a0c-bcb3-20a869d51934
   /usr/bin/qemu-system-x86_64 <span class="token punctuation">(</span><span class="token number">366380</span><span class="token punctuation">)</span> libvirt-9b850c34-dec9-4f83-b7e6-f3667556aa1a
   /usr/bin/qemu-system-x86_64 <span class="token punctuation">(</span><span class="token number">3246640</span><span class="token punctuation">)</span> libvirt-b6b75415-de22-4846-a56b-45e0ace7a6f6
   /usr/bin/qemu-system-x86_64 <span class="token punctuation">(</span><span class="token number">1254500</span><span class="token punctuation">)</span> libvirt-ccf5b79c-0ba1-4067-92c4-475d85c3e91c
   /usr/bin/qemu-system-x86_64 <span class="token punctuation">(</span><span class="token number">2185108</span><span class="token punctuation">)</span> libvirt-e2416988-4191-4209-9b38-dfaabf2015d1
   /usr/bin/qemu-system-x86_64 <span class="token punctuation">(</span><span class="token number">365344</span><span class="token punctuation">)</span> libvirt-ed563373-5625-4e84-8bbb-4fa569418c66
   /usr/bin/qemu-system-x86_64 <span class="token punctuation">(</span><span class="token number">387769</span><span class="token punctuation">)</span> libvirt-ef0a4fc5-8a0a-4f2b-8a06-78348397ef3b
   /usr/sbin/libvirtd <span class="token punctuation">(</span><span class="token number">2013</span><span class="token punctuation">)</span> libvirtd
<span class="token number">0</span> processes are <span class="token keyword">in</span> complain mode.
<span class="token number">0</span> processes are unconfined but have a profile defined.</code></pre></div>
<p>위의 AppArmor Profile에 따르면, <code class="language-text">/</code>로 시작하는 이름과 <code class="language-text">/</code>로 시작하지 않는 이름으로 구분된다.
두 가지 이름의 차이점은 Profile이 자동으로 적용되는지 여부이다.</p>
<p><code class="language-text">/</code>로 시작하는 Profile의 경우, Profile의 이름이 해당 Profile이 적용되는 프로그램을 나타낸다.
즉, 위의 Bash 출력 결과에서 <code class="language-text">/usr/sbin/tcpdump</code> Profile의 경우, <code class="language-text">/usr/sbin/tcpdump</code> 프로그램이 실행되면 자동으로 <code class="language-text">/usr/sbin/tcpdump</code> Profile이 적용되어 동작하게 된다.</p>
<p><code class="language-text">/</code>로 시작하지 않는 Profile의 경우, 해당 프로그램을 동작시킬 때 <code class="language-text">aa-exec</code> 명령어를 통해 수동으로 Profile을 적용시켜야 한다.</p>
<p>AppArmor에 적용된 Profile은 <code class="language-text">/etc/apparmor.d</code>에 위치하고 있다.</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">root@bastion:/etc/apparmor.d<span class="token comment"># ll</span>
total <span class="token number">156</span>
drwxr-xr-x   <span class="token number">8</span> root root  <span class="token number">4096</span> <span class="token number">10</span>월  <span class="token number">6</span> 06:48 ./
drwxr-xr-x <span class="token number">160</span> root root <span class="token number">12288</span> <span class="token number">10</span>월 <span class="token number">29</span> 06:53 <span class="token punctuation">..</span>/
drwxr-xr-x   <span class="token number">4</span> root root  <span class="token number">4096</span>  <span class="token number">5</span>월  <span class="token number">4</span> 06:06 abstractions/
drwxr-xr-x   <span class="token number">2</span> root root  <span class="token number">4096</span>  <span class="token number">8</span>월  <span class="token number">1</span>  <span class="token number">2020</span> disable/
drwxr-xr-x   <span class="token number">2</span> root root  <span class="token number">4096</span>  <span class="token number">2</span>월 <span class="token number">12</span>  <span class="token number">2020</span> force-complain/
drwxr-xr-x   <span class="token number">2</span> root root  <span class="token number">4096</span>  <span class="token number">8</span>월 <span class="token number">17</span> <span class="token number">13</span>:47 libvirt/
drwxr-xr-x   <span class="token number">3</span> root root  <span class="token number">4096</span> <span class="token number">10</span>월 <span class="token number">17</span>  <span class="token number">2021</span> local/
-rw-r--r--   <span class="token number">1</span> root root  <span class="token number">1313</span>  <span class="token number">5</span>월 <span class="token number">20</span>  <span class="token number">2020</span> lsb_release
-rw-r--r--   <span class="token number">1</span> root root  <span class="token number">1108</span>  <span class="token number">5</span>월 <span class="token number">20</span>  <span class="token number">2020</span> nvidia_modprobe
-rw-r--r--   <span class="token number">1</span> root root  <span class="token number">3461</span>  <span class="token number">6</span>월 <span class="token number">21</span> <span class="token number">19</span>:44 sbin.dhclient
drwxr-xr-x   <span class="token number">5</span> root root  <span class="token number">4096</span> <span class="token number">10</span>월 <span class="token number">17</span>  <span class="token number">2021</span> tunables/
-rw-r--r--   <span class="token number">1</span> root root <span class="token number">11082</span>  <span class="token number">7</span>월  <span class="token number">7</span>  <span class="token number">2020</span> usr.bin.evince
-rw-r--r--   <span class="token number">1</span> root root  <span class="token number">9793</span>  <span class="token number">8</span>월 <span class="token number">19</span> <span class="token number">14</span>:25 usr.bin.firefox
-rw-r--r--   <span class="token number">1</span> root root  <span class="token number">3202</span>  <span class="token number">2</span>월 <span class="token number">26</span>  <span class="token number">2020</span> usr.bin.man
-rw-r--r--   <span class="token number">1</span> root root   <span class="token number">633</span> <span class="token number">12</span>월 <span class="token number">11</span>  <span class="token number">2019</span> usr.lib.ibus.ibus-engine-hangul
-rw-r--r--   <span class="token number">1</span> root root   <span class="token number">941</span> <span class="token number">12</span>월 <span class="token number">11</span>  <span class="token number">2019</span> usr.lib.ibus.ibus-setup-hangul
-rw-r--r--   <span class="token number">1</span> root root  <span class="token number">2581</span> <span class="token number">10</span>월  <span class="token number">8</span>  <span class="token number">2020</span> usr.lib.libvirt.virt-aa-helper
-rw-r--r--   <span class="token number">1</span> root root <span class="token number">28249</span>  <span class="token number">2</span>월 <span class="token number">18</span>  <span class="token number">2022</span> usr.lib.snapd.snap-confine.real
-rw-r--r--   <span class="token number">1</span> root root   <span class="token number">540</span>  <span class="token number">4</span>월 <span class="token number">10</span>  <span class="token number">2020</span> usr.sbin.cups-browsed
-rw-r--r--   <span class="token number">1</span> root root  <span class="token number">5797</span>  <span class="token number">4</span>월 <span class="token number">24</span>  <span class="token number">2020</span> usr.sbin.cupsd
-rw-r--r--   <span class="token number">1</span> root root   <span class="token number">672</span>  <span class="token number">2</span>월 <span class="token number">19</span>  <span class="token number">2020</span> usr.sbin.ippusbxd
-rw-r--r--   <span class="token number">1</span> root root  <span class="token number">4653</span>  <span class="token number">6</span>월 <span class="token number">14</span>  <span class="token number">2021</span> usr.sbin.libvirtd
-rw-r--r--   <span class="token number">1</span> root root  <span class="token number">2425</span> <span class="token number">11</span>월 <span class="token number">28</span>  <span class="token number">2020</span> usr.sbin.ntpd
-rw-r--r--   <span class="token number">1</span> root root  <span class="token number">1575</span>  <span class="token number">2</span>월 <span class="token number">12</span>  <span class="token number">2020</span> usr.sbin.rsyslogd
-rw-r--r--   <span class="token number">1</span> root root  <span class="token number">1385</span> <span class="token number">12</span>월  <span class="token number">8</span>  <span class="token number">2019</span> usr.sbin.tcpdump</code></pre></div>
<h4 id="apparmor-profile" style="position:relative;"><a href="#apparmor-profile" aria-label="apparmor profile permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>AppArmor Profile</h4>
<p>다음은 AppArmor의 예제 Profile인 <code class="language-text">apparmor-example</code>이다.</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token comment"># vim:syntax=apparmor</span>
<span class="token comment">#include &lt;tunables/global></span>

profile apparmor-example <span class="token punctuation">{</span>
  <span class="token comment">#include &lt;abstractions/base></span>

  capability net_admin,
  capability setuid,
  capability setgid,

  <span class="token function">mount</span> <span class="token assign-left variable">fstype</span><span class="token operator">=</span>proc -<span class="token operator">></span> /mnt/proc/**,

  /etc/hosts.allow rw,
  /root/test.sh rwix,
  /root/test_file w,

  network tcp,
<span class="token punctuation">}</span></code></pre></div>
<p>프로필은 각각 다음과 같은 의미를 나타내고 있다.</p>
<ul>
<li><code class="language-text">net_admin</code>, <code class="language-text">setuid</code>, <code class="language-text">setgid</code> Capability를 이용할 수 있다.</li>
<li><code class="language-text">proc</code> 파일 시스템을 <code class="language-text">/mnt/proc/</code> 아래의 경로에만 mount 시킬 수 있다.</li>
<li><code class="language-text">/etc/hosts.allow</code> 파일을 읽고 쓸 수 있다.</li>
<li><code class="language-text">/root/test.sh</code> 파일을 읽고, 쓰고, 실행할 수 있다.</li>
<li><code class="language-text">/root/test_file</code> 파일을 쓸 수만 있다.</li>
<li><code class="language-text">tcp</code> 프로토콜만 이용할 수 있다.</li>
</ul>
<p>해당 Profile을 <code class="language-text">apparmor_parser</code> 명령어를 이용하여 AppArmor에 등록하고, <code class="language-text">aa-status</code> 명령어를 통해 AppArmor Profile에 등록된 <code class="language-text">apparmor-example</code> Profile을 확인할 수 있다.</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">root@hoth:/etc/apparmor.d<span class="token comment"># apparmor_parser /etc/apparmor.d/test/apparmor-example </span>
root@hoth:/etc/apparmor.d<span class="token comment"># aa-status</span>
apparmor module is loaded.
<span class="token number">64</span> profiles are loaded.
<span class="token number">61</span> profiles are <span class="token keyword">in</span> enforce mode.
   <span class="token punctuation">..</span>.
   /usr/sbin/tcpdump
   /<span class="token punctuation">{</span>,usr/<span class="token punctuation">}</span>sbin/dhclient
   apparmor-example
   docker-default
   ippusbxd
   <span class="token punctuation">..</span>.
<span class="token number">0</span> processes are <span class="token keyword">in</span> complain mode.
<span class="token number">0</span> processes are unconfined but have a profile defined.</code></pre></div>
<p>아래는 <code class="language-text">aa-exec</code> 명령어를 통해 <code class="language-text">apparmor-example</code> Profile을 <code class="language-text">cat</code>과 <code class="language-text">echo</code> 명령어에 적용시킨 모습을 보여준다.</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">root@hoth:/etc/apparmor.d<span class="token comment"># echo test > /root/test_file</span>
root@hoth:/etc/apparmor.d<span class="token comment"># aa-exec -p apparmor-example cat /root/test_file</span>
cat: /root/test_file: Permission denied
root@hoth:/etc/apparmor.d<span class="token comment"># aa-exec -p apparmor-example echo apparmor > /root/test_file </span>
root@hoth:/etc/apparmor.d<span class="token comment"># cat /root/test_file </span>
apparmor</code></pre></div>
<p>Profile에 따라 <code class="language-text">/root/test_file</code> 파일에 쓰기 동작은 정상적으로 수행되지만, 읽기 동작은 deny되는 것을 볼 수 있다.</p>
<p>참고로 해당 프로필을 삭제하고, 전체 프로필을 reload 하는 명령어는 <code class="language-text">sudo service apparmor reload</code>이다.</p>
<h3 id="33-smack---simplified-mandatory-access-control" style="position:relative;"><a href="#33-smack---simplified-mandatory-access-control" aria-label="33 smack   simplified mandatory access control permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>3.3. SMACK - Simplified Mandatory Access Control</h3>
<p>SMACK은 리눅스 커널 v2.6.24 릴리즈에서 메인스트림에 병합되었고 커널에 2번째로 추가된 LSM Module이다.</p>
<p>SMACK은 SELiux와 마찬가지로 attribute 기반 MAC의 구현제로 임베디드 시스템을 위해 설계되었으며, SELinux와 비교했을 때, 보다 관리가 간편하다는 장점이 있다.
또한, SMACK은 Automotive Grade Linux와 Tizen의 기본 MAC 구현체로 지정되어 있다.</p>
<blockquote>
<p>Automative Grade Linux: 자동차 애플리케이션을 위한 개방형 운영 체제 및 프레임워크를 구축하는 Linux Foundation에서 주최하는 오픈 소스 프로젝트
Tizen: 리눅스 재단, 리모 재단, 삼성전자, 인텔이 공동으로 개발한 IT기기를 지원하는 운영 체제. TV, 냉장고, 휴대용 장치와 같은 모든 전자기기에 포함을 목적으로 하는 오픈 소스 모바일 운영 체제.</p>
</blockquote>
<p>SMACK은 각 subject(e.g., 사용자, application, 프로세스)와 object(e.g., 파일, 소켓, 디렉터리, 디바이스)에 연결된 레이블을 기준으로 어떤 subject가 어떤 object에 액세스할 수 있는지에 대해 DAC을 넘어 추가적인 제어가 가능한다.</p>
<p>SMACK 역시 extended attributes(<code class="language-text">xattrs</code>)를 사용하여 파일 시스템 object에 레이블을 저장하고 extended security namespace에 저장된다.</p>
<h3 id="34-tomoyo" style="position:relative;"><a href="#34-tomoyo" aria-label="34 tomoyo permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>3.4. TOMOYO</h3>
<p>TOMOYO는 리눅스 커널 v2.6.30에 병합되었으며, SELinux, AppArmor, SMACK과 함께 4가지 표준 LSM Module 중 하나이다.
AppArmor와 비슷하게, Path 기반 MAC을 제공하는 구현체이다.
주요 기능으로는 프로세스의 실행 기록을 기반으로 시스템을 분석하여 자동으로 정책을 결정하는 기능이 있다.</p>
<h3 id="35-loadpin" style="position:relative;"><a href="#35-loadpin" aria-label="35 loadpin permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>3.5. LoadPin</h3>
<p>LoadPin은 리눅스 커널 v4.7에 병합된 Minor LSM Module이다.
LoadPin은 모든 커널 로드 파일이 동일한 파일 시스템에서 생성되도록 보장하는 기능을 수행한다.
이를 통해 커널 모듈 signing infrastructure나 읽기 전용 장치에서 부팅하도록 시스템이 구성되어 있는지에 대한 여부를 확인할 필요가 없어지므로 임베디드 시스템에서 강점을 가진다.</p>
<h3 id="36-yama" style="position:relative;"><a href="#36-yama" aria-label="36 yama permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>3.6. Yama</h3>
<p>Yama는 리눅스 커널 v3.4에 병합된 Minor LSM으로 코어 커널에 의해 처리되지 않는 시스템 전체의 DAC 보안 방법들을 모아둔 LSM Module이다.
최근 Yama는 <code class="language-text">ptrace()</code> 시스템콜이 어떠한 프로세스에 보안 공격에 이루어졌을 때, 해당 프로세스에서 중요한 정보를 추출할 수 없도록 <code class="language-text">ptrace()</code> 시스템콜의 영역을 제한하는 기능을 지원한다.</p>
<h3 id="37-safesetid" style="position:relative;"><a href="#37-safesetid" aria-label="37 safesetid permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>3.7. SafeSetID</h3>
<p>SafeSetID는 리눅스 커널 v5.1에 병합된 Minor LSM이다.
주어진 UID/GID에서 시스템 전체 whitelist에 의해 승인된 것으로만 UID/GID 전환을 제한하기 위해 사용한다.</p>
<h3 id="38-landlock" style="position:relative;"><a href="#38-landlock" aria-label="38 landlock permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>3.8. Landlock</h3>
<p>Landlock은 리눅스 커널 v5.13에 병합된 Minor LSM Module이다.
권한 있는 프로세스이더라도 자신의 불필요한 권한(e.g., 파일 액세스)을 제한함으로써, 어플리케이션이 안전하게 구동할 수 있는 샌드박스 환경을 제공하는 것을 목표로한다.</p>
<h3 id="39-lockdown" style="position:relative;"><a href="#39-lockdown" aria-label="39 lockdown permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>3.9. Lockdown</h3>
<p>Lockdown은 리눅스 커널 v5.4에 병합된 Minor LSM Module로써 커널에 대한 ‘Lockdown(잠금)’ 기능을 제공한다.
Lockdown LSM을 사용하도록 설정할 경우, 커널 command line 매개변수를 사용해서 integrity(무결성) 및 confidentiality(기밀성)을 위해 커널을 locking하는 것이 가능해진다.</p>
<p>Lockdown LSM을 integrity 모드로 설정하면 아래와 같은 경우에 커널을 수정할 수 없게 된다.</p>
<ul>
<li>서명되지 않은 모듈 로딩, <code class="language-text">/dev/{mem,kmem,port}</code>에 대한 접근</li>
<li>서명되지 않은 이미지에 대한 <code class="language-text">kexec</code>, <code class="language-text">hibernation</code>, 직접 PCI 접근</li>
<li>Raw IO Port 접근, raw MSR 액세스, ACPI 테이블 수정, 안전하지 않은 모듈 파라미터, 안전하지 않은 mmio와 debugfs 접근</li>
</ul>
<p>Lockdown LSM을 integrity와 confidentiality 모드로 설정한 경우 <code class="language-text">/proc/kcore</code> 액세스와 같이 실행 중인 커널에서 잠재적으로 기밀 정보를 추출할 수 있는 기능이 비활성화되며, kprobe 사용, BPF에서 커널 RAM 읽기, 안전하지 않은 perf 사용 및 tracefs 사용이 제한된다.</p>
<h2 id="reference" style="position:relative;"><a href="#reference" aria-label="reference permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Reference</h2>
<ul>
<li><a href="https://www.kernel.org/doc/html/v5.8/security/lsm.html">https://www.kernel.org/doc/html/v5.8/security/lsm.html</a></li>
<li><a href="https://www.accuknox.com/blog/an-introduction-to-linux-security-modules">https://www.accuknox.com/blog/an-introduction-to-linux-security-modules</a></li>
<li><a href="https://ssup2.github.io/theory_analysis/Linux_LSM/">https://ssup2.github.io/theory_analysis/Linux_LSM/</a></li>
<li><a href="https://www.lesstif.com/ws/access-control-dac-mac-43843837.html">https://www.lesstif.com/ws/access-control-dac-mac-43843837.html</a></li>
<li><a href="https://www.kernel.org/doc/html/latest/admin-guide/LSM/index.html">https://www.kernel.org/doc/html/latest/admin-guide/LSM/index.html</a></li>
<li><a href="https://www.starlab.io/blog/a-brief-tour-of-linux-security-modules">https://www.starlab.io/blog/a-brief-tour-of-linux-security-modules</a></li>
<li><a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html/selinux_users_and_administrators_guide/chap-security-enhanced_linux-introduction">https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html/selinux_users_and_administrators_guide/chap-security-enhanced_linux-introduction</a></li>
<li><a href="https://www.redhat.com/sysadmin/apparmor-selinux-isolation">https://www.redhat.com/sysadmin/apparmor-selinux-isolation</a></li>
</ul>
<script src="https://utteranc.es/client.js"
        repo="sominsong/sominsong.github.io"
        issue-term="pathname"
        label="Comment"
        theme="github-light"
        crossorigin="anonymous"
        async>
</script>
<div class="table-of-contents">
<ul>
<li>
<p><a href="#0-lsm-linux-security-module">0. LSM (Linux Security Module)</a></p>
<ul>
<li>
<p><a href="#dacs-vs-macs">DACs vs. MACs</a></p>
<ul>
<li>
<p><a href="#dacs">DACs</a></p>
<ul>
<li><a href="#setuidsetgid-%EB%AC%B8%EC%A0%9C">setuid/setgid 문제</a></li>
<li><a href="#well-known-port-daemon-%EB%AC%B8%EC%A0%9C">Well-known port daemon 문제</a></li>
</ul>
</li>
<li>
<p><a href="#macs">MACs</a></p>
</li>
</ul>
</li>
</ul>
</li>
<li>
<p><a href="#1-lsm-framework">1. LSM Framework</a></p>
<ul>
<li><a href="#security-field">Security field</a></li>
</ul>
</li>
<li>
<p><a href="#2-lsm-hooks">2. LSM Hooks</a></p>
<ul>
<li><a href="#lsm-hooks-with-system-call">LSM Hooks with System call</a></li>
</ul>
</li>
<li>
<p><a href="#3-security-module">3. Security Module</a></p>
<ul>
<li>
<p><a href="#31-selinux---security-enhanced-linux">3.1. SELinux - Security Enhanced Linux</a></p>
<ul>
<li><a href="#selinux%EC%9D%98-%EC%9D%B4%EC%A0%90">SELinux의 이점</a></li>
<li><a href="#selinux%EC%9D%98-%ED%95%9C%EA%B3%84">SELinux의 한계</a></li>
</ul>
</li>
<li>
<p><a href="#32-apparmor">3.2. AppArmor</a></p>
<ul>
<li><a href="#apparmor-profile">AppArmor Profile</a></li>
</ul>
</li>
<li>
<p><a href="#33-smack---simplified-mandatory-access-control">3.3. SMACK - Simplified Mandatory Access Control</a></p>
</li>
<li>
<p><a href="#34-tomoyo">3.4. TOMOYO</a></p>
</li>
<li>
<p><a href="#35-loadpin">3.5. LoadPin</a></p>
</li>
<li>
<p><a href="#36-yama">3.6. Yama</a></p>
</li>
<li>
<p><a href="#37-safesetid">3.7. SafeSetID</a></p>
</li>
<li>
<p><a href="#38-landlock">3.8. Landlock</a></p>
</li>
<li>
<p><a href="#39-lockdown">3.9. Lockdown</a></p>
</li>
</ul>
</li>
<li>
<p><a href="#reference">Reference</a></p>
</li>
</ul>
</div></div></div><div class="post-navigator"><div class="post-navigator-card-wrapper"><a class="post-card prev" href="/TIL/Security_3/"><div class="direction">이전 글</div><div class="title">TIL - 정보 보안의 3요소</div></a></div><div class="post-navigator-card-wrapper"><a class="post-card next" href="/TIL/BCC/"><div class="direction">다음 글</div><div class="title">TIL - BCC (eBPF Compiler Collection)</div></a></div></div><div class="utterances"></div></main><footer class="page-footer-wrapper"><p class="page-footer">© <!-- -->2022<!-- --> <a href="https://github.com/sominsong">송소민</a> powered by<a href="https://github.com/zoomKoding/zoomkoding-gatsby-blog"> zoomkoding-gatsby-blog</a></p></footer><div class="dark-mode-button-wrapper"><button class="MuiButtonBase-root MuiIconButton-root MuiIconButton-sizeMedium dark-mode-button css-1yxmbwk" tabindex="0" type="button"><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeLarge dark-mode-icon css-6flbmm" focusable="false" viewBox="0 0 24 24" aria-hidden="true" data-testid="DarkModeIcon"><path d="M12 3c-4.97 0-9 4.03-9 9s4.03 9 9 9 9-4.03 9-9c0-.46-.04-.92-.1-1.36-.98 1.37-2.58 2.26-4.4 2.26-2.98 0-5.4-2.42-5.4-5.4 0-1.81.89-3.42 2.26-4.4-.44-.06-.9-.1-1.36-.1z"></path></svg></button></div></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/TIL/LSM/";window.___webpackCompilationHash="b506844c5448546b5b51";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-9b356b5dc44213e24f34.js"],"app":["/app-2a3abbc7799f752aeec3.js"],"component---cache-caches-gatsby-plugin-offline-app-shell-js":["/component---cache-caches-gatsby-plugin-offline-app-shell-js-ffdb1e83dd2925d16ce3.js"],"component---src-pages-404-js":["/component---src-pages-404-js-bc51420b294b9123f97d.js"],"component---src-pages-about-js":["/component---src-pages-about-js-39e57401fb032eafb2fb.js"],"component---src-pages-index-js":["/component---src-pages-index-js-0a6bbda26eb501968935.js"],"component---src-templates-blog-template-js":["/component---src-templates-blog-template-js-dc3d26b2be7d8f1b7ec9.js"],"component---src-templates-category-template-js":["/component---src-templates-category-template-js-a0af7e239c6cf28d9bb9.js"]};/*]]>*/</script><script src="/polyfill-9b356b5dc44213e24f34.js" nomodule=""></script><script src="/component---src-templates-blog-template-js-dc3d26b2be7d8f1b7ec9.js" async=""></script><script src="/f9d3028dbef90a6e9b8db85387d63dd9f4edf538-064f8125dbb44e660b41.js" async=""></script><script src="/app-2a3abbc7799f752aeec3.js" async=""></script><script src="/framework-043f1197be387cb18d15.js" async=""></script><script src="/webpack-runtime-11fab238ab053aae2627.js" async=""></script></body></html>